<html><!-- Mirrored from www.php.net/manual/en/function.readline-completion-function.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 07:12:20 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>readline_completion_function</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.readline-completion-function.html">
 <link rel="shorturl" href="https://www.php.net/readline-completion-function">
 <link rel="alternate" href="https://www.php.net/readline-completion-function" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.readline.html">
 <link rel="prev" href="function.readline-clear-history.html">
 <link rel="next" href="function.readline-info.html">

 <link rel="alternate" href="function.readline-completion-function.html" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/function.readline-completion-function.php" hreflang="pt_BR">
 <link rel="alternate" href="https://www.php.net/manual/zh/function.readline-completion-function.php" hreflang="zh">
 <link rel="alternate" href="https://www.php.net/manual/fr/function.readline-completion-function.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/de/function.readline-completion-function.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/ja/function.readline-completion-function.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/ro/function.readline-completion-function.php" hreflang="ro">
 <link rel="alternate" href="https://www.php.net/manual/ru/function.readline-completion-function.php" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/es/function.readline-completion-function.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/tr/function.readline-completion-function.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached0aba.css?t=1539771603&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached2ecf.css?t=1539765004&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedba57.css?t=1606338002&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached3afa.css?t=1627831203&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script>
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script src="https://www.php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>


</head>
<body class="docs " style="">


<div class="headsup"><a href="https://www.php.net/conferences/index.php#id2021-09-08-1">Longhorn PHP 2021</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.errors.html">Errors</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.attributes.html">Attributes</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.sessions.html">Session Security</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
	<dd><a href="refs.ui.html">GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
    <div id="breadcrumbs-inner">
          
              
          <ul>
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></li>      <li><a href="book.readline.html">Readline</a></li>      <li><a href="ref.readline.html">Readline Functions</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div id="function.readline-completion-function" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">readline_completion_function</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">readline_completion_function</span> â€” <span class="dc-title">Registers a completion function</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.readline-completion-function-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>readline_completion_function</strong></span>(<span class="methodparam"><span class="type"><a href="language.types.callable.html" class="type callable">callable</a></span> <code class="parameter">$callback</code></span>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   This function registers a completion function. This is the same kind of
   functionality you'd get if you hit your tab key while using Bash.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.readline-completion-function-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>
    
     <dt>
<code class="parameter">callback</code></dt>

     <dd>

      <p class="para">
       You must supply the name of an existing function which accepts a
       partial command line and returns an array of possible matches.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.readline-completion-function-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <strong><code>true</code></strong> on success or <strong><code>false</code></strong> on failure.
  </p>
 </div>

</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="94855">  
  <a class="name">
  <strong class="user"><em>chris AT w3style DOT co  UK</em></strong></a><div class="date" title="2009-11-28 08:39"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom94855">
<div class="phpcode"><code><span class="html">
A little bit of info regarding useful variables when writing your callback function.<br><br>There doesn't seem to be a way to set rl_basic_word_break_characters like with the pure C library, so as previous users have pointed out you'll only receive the current word in the input buffer within your callback.&nbsp; If for example you're typing "big bro|ther", where the bar is the position of your cursor when you hit TAB, you'll receive (string) "brother" and (int) 4 as your callback parameters.<br><br>However, it is possible (easily) to get more useful information about what the user has typed into the readline buffer.&nbsp; readline_info() is key here.&nbsp; It will return an array containing:<br><br>"line_buffer" =&gt; (string)<br>&nbsp;&nbsp; the entire contents of the line buffer (+ some bugs**)<br><br>"point" =&gt; (int)<br>&nbsp;&nbsp; the current position of the cursor in the buffer<br><br>"end" =&gt; (int)<br>&nbsp;&nbsp; the position of the last character in the buffer<br><br>So for the example above you'd get:<br><br>&nbsp; * line_buffer =&gt; "big brother"<br>&nbsp; * point =&gt; 7<br>&nbsp; * end =&gt; 11<br><br>From this you can easily perform multi-word matches.<br><br>** NOTE: line_buffer seems to contain spurious data at the end of the string sometime.&nbsp; Fortunately since $end is provided you can substr() it to get the correct value.<br><br>The matches you need to return are full words that can replace $input, so your algorithm might crudely look something like:<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">your_callback</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">) {<br>&nbsp; </span><span class="comment">// Get info about the current buffer<br>&nbsp; </span><span class="default">$rl_info </span><span class="keyword">= </span><span class="default">readline_info</span><span class="keyword">();<br>&nbsp; <br>&nbsp; </span><span class="comment">// Figure out what the entire input is<br>&nbsp; </span><span class="default">$full_input </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$rl_info</span><span class="keyword">[</span><span class="string">'line_buffer'</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">, </span><span class="default">$rl_info</span><span class="keyword">[</span><span class="string">'end'</span><span class="keyword">]);<br>&nbsp; <br>&nbsp; </span><span class="default">$matches </span><span class="keyword">= array();<br>&nbsp; <br>&nbsp; </span><span class="comment">// Get all matches based on the entire input buffer<br>&nbsp; </span><span class="keyword">foreach (</span><span class="default">phrases_that_begin_with</span><span class="keyword">(</span><span class="default">$full_input</span><span class="keyword">) as </span><span class="default">$phrase</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="comment">// Only add the end of the input (where this word begins)<br>&nbsp; &nbsp; // to the matches array<br>&nbsp; &nbsp; </span><span class="default">$matches</span><span class="keyword">[] = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$phrase</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">);<br>&nbsp; }<br>&nbsp; <br>&nbsp; return </span><span class="default">$matches</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="117110">  
  <a class="name">
  <strong class="user"><em>cameron at cloudix dot co dot nz</em></strong></a><div class="date" title="2015-04-16 03:36"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom117110">
<div class="phpcode"><code><span class="html">
The readline extension can be a bit flakey due to bugs in libedit (PHP 5.3.10-1ubuntu3.15 with Suhosin-Patch (cli) (built: Oct 29 2014 12:19:04)).<br><br>I created many segfaults returning an empty array on the autocompletion function:<br><br>// Autocomplete<br>readline_completion_function(function($Input, $Index){<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; global $Commands;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; // Filter Matches&nbsp; &nbsp; <br>&nbsp; &nbsp; $Matches = array();<br>&nbsp; &nbsp; foreach(array_keys($Commands) as $Command)<br>&nbsp; &nbsp; &nbsp; &nbsp; if(stripos($Command, $Input) === 0)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $Matches[] = $Command;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return $Matches;<br>});<br><br>I found adding an empty string to the matches array prevents the segfault:<br><br>// Autocomplete<br>readline_completion_function(function($Input, $Index){<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; global $Commands;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; // Filter Matches&nbsp; &nbsp; <br>&nbsp; &nbsp; $Matches = array();<br>&nbsp; &nbsp; foreach(array_keys($Commands) as $Command)<br>&nbsp; &nbsp; &nbsp; &nbsp; if(stripos($Command, $Input) === 0)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $Matches[] = $Command;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; // Prevent Segfault<br>&nbsp; &nbsp; if($Matches == false)<br>&nbsp; &nbsp; &nbsp; &nbsp; $Matches[] = '';<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return $Matches;<br>});<br><br>Hopefully this is helpful to someone.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="91769">  
  <a class="name">
  <strong class="user"><em>overshoot.tv</em></strong></a><div class="date" title="2009-06-25 12:07"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom91769">
<div class="phpcode"><code><span class="html">
Note: the first argument passed to the registered function is NOT the whole command line as entered by the user, but only the last part, i.e. the part after the last space.
<br>
<br>e.g.:
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">my_readline_completion_function</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">) {
<br>&nbsp; </span><span class="comment">// If the user is typing:
<br>&nbsp; // mv file.txt directo[TAB]
<br>&nbsp; // then:
<br>&nbsp; // $string = directo
<br>&nbsp; // the $index is the place of the cursor in the line:
<br>&nbsp; // $index = 19; 
<br>
<br>&nbsp; </span><span class="default">$array </span><span class="keyword">= array(
<br>&nbsp; &nbsp; </span><span class="string">'ls'</span><span class="keyword">,
<br>&nbsp; &nbsp; </span><span class="string">'mv'</span><span class="keyword">,
<br>&nbsp; &nbsp; </span><span class="string">'dar'</span><span class="keyword">,
<br>&nbsp; &nbsp; </span><span class="string">'exit'</span><span class="keyword">,
<br>&nbsp; &nbsp; </span><span class="string">'quit'</span><span class="keyword">,
<br>&nbsp; );
<br>
<br>&nbsp; </span><span class="comment">// Here, I decide not to return filename autocompletion for the first argument (0th argument).
<br>&nbsp; </span><span class="keyword">if (</span><span class="default">$index</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$ls </span><span class="keyword">= `</span><span class="string">ls</span><span class="keyword">`;
<br>&nbsp; &nbsp; </span><span class="default">$lines </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$ls</span><span class="keyword">);
<br>&nbsp; &nbsp; foreach (</span><span class="default">$lines </span><span class="keyword">AS </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$line</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$lines</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] .= </span><span class="string">'/'</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$array</span><span class="keyword">[] = </span><span class="default">$lines</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">];
<br>&nbsp; &nbsp; }
<br>&nbsp; }
<br>&nbsp; </span><span class="comment">// This will return both our list of functions, and, possibly, a list of files in the current filesystem.
<br> // php will filter itself according to what the user is typing.
<br>&nbsp; </span><span class="keyword">return </span><span class="default">$array</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="25387">  
  <a class="name">
  <strong class="user"><em>john at weider dot cc</em></strong></a><div class="date" title="2002-09-21 09:32"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom25387">
<div class="phpcode"><code><span class="html">
It seems that the registered function can accept 2 parameters, the first being the partial string, the second a number that when equal to zero indicates that the tab was hit on the first argument on the input. Otherwise it looks like the position within the string is returned.<br><br>This is neccessary information for processing shell command line input.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="49566">  
  <a class="name">
  <strong class="user"><em>david at acz dot org</em></strong></a><div class="date" title="2005-02-01 12:08"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom49566">
<div class="phpcode"><code><span class="html">
This function can simply return an array of all possible matches (regardless of the current user intput) and readline will handle the matching itself.&nbsp; This is likely to be much faster than attempting to handle partial matches in PHP.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->

  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from www.php.net/manual/en/function.readline-completion-function.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 07:12:20 GMT -->

</body></html>