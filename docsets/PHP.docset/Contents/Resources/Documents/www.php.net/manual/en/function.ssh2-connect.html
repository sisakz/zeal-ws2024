<html><!-- Mirrored from www.php.net/manual/en/function.ssh2-connect.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 06:31:36 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>ssh2_connect</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.ssh2-connect.html">
 <link rel="shorturl" href="https://www.php.net/ssh2-connect">
 <link rel="alternate" href="https://www.php.net/ssh2-connect" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.ssh2.html">
 <link rel="prev" href="function.ssh2-auth-pubkey-file.html">
 <link rel="next" href="function.ssh2-disconnect.html">

 <link rel="alternate" href="function.ssh2-connect.html" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/function.ssh2-connect.php" hreflang="pt_BR">
 <link rel="alternate" href="https://www.php.net/manual/zh/function.ssh2-connect.php" hreflang="zh">
 <link rel="alternate" href="https://www.php.net/manual/fr/function.ssh2-connect.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/de/function.ssh2-connect.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/ja/function.ssh2-connect.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/ro/function.ssh2-connect.php" hreflang="ro">
 <link rel="alternate" href="https://www.php.net/manual/ru/function.ssh2-connect.php" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/es/function.ssh2-connect.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/tr/function.ssh2-connect.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached0aba.css?t=1539771603&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached2ecf.css?t=1539765004&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedba57.css?t=1606338002&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached3afa.css?t=1627831203&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script>
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="https://www.php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script src="https://www.php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>


</head>
<body class="docs " style="">


<div class="headsup"><a href="https://www.php.net/conferences/index.php#id2021-09-08-1">Longhorn PHP 2021</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.errors.html">Errors</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.attributes.html">Attributes</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.sessions.html">Session Security</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
	<dd><a href="refs.ui.html">GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
    <div id="breadcrumbs-inner">
          
              
          <ul>
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.remote.other.html">Other Services</a></li>      <li><a href="book.ssh2.html">SSH2</a></li>      <li><a href="ref.ssh2.html">SSH2 Functions</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div id="function.ssh2-connect" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ssh2_connect</h1>
  <p class="verinfo">(PECL ssh2 &gt;= 0.9.0)</p><p class="refpurpose"><span class="refname">ssh2_connect</span> — <span class="dc-title">Connect to an SSH server</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.ssh2-connect-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>ssh2_connect</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$host</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$port</code><span class="initializer"> = 22</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">array</span> <code class="parameter">$methods</code><span class="initializer"> = ?</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">array</span> <code class="parameter">$callbacks</code><span class="initializer"> = ?</span></span><br>): <span class="type">resource</span></div>

  <p class="para rdfs-comment">
   Establish a connection to a remote SSH server.
  </p>
  <p class="para">
   Once connected, the client should verify the server's hostkey using
   <span class="function"><a href="function.ssh2-fingerprint.html" class="function">ssh2_fingerprint()</a></span>, then authenticate using either
   password or public key.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.ssh2-connect-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>
    
     <dt>
<code class="parameter">host</code></dt>

     <dd>

      <p class="para">
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">port</code></dt>

     <dd>

      <p class="para">
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">methods</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">methods</code> may be an associative array with up to four parameters
       as described below.
      </p>
      <p class="para">
       </p><table class="doctable table">
        <caption><strong><code class="parameter">methods</code> may be an associative array
               with any or all of the following parameters.</strong></caption>
        
         <thead>
          <tr>
           <th>Index</th>
           <th>Meaning</th>
           <th>Supported Values*</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td>kex</td>
           <td>
            List of key exchange methods to advertise, comma separated
            in order of preference.
           </td>
           <td>
            <code class="literal">diffie-hellman-group1-sha1</code>,
            <code class="literal">diffie-hellman-group14-sha1</code>, and
            <code class="literal">diffie-hellman-group-exchange-sha1</code>
           </td>
          </tr>

          <tr>
           <td>hostkey</td>
           <td>
            List of hostkey methods to advertise, comma separated
            in order of preference.
           </td>
           <td>
            <code class="literal">ssh-rsa</code> and
            <code class="literal">ssh-dss</code>
           </td>
          </tr>

          <tr>
           <td>client_to_server</td>
           <td>
            Associative array containing crypt, compression, and
            message authentication code (MAC) method preferences
            for messages sent from client to server.
           </td>
           <td class="empty">&nbsp;</td>
          </tr>

          <tr>
           <td>server_to_client</td>
           <td>
            Associative array containing crypt, compression, and
            message authentication code (MAC) method preferences
            for messages sent from server to client.
           </td>
           <td class="empty">&nbsp;</td>
          </tr>

         </tbody>
        
       </table>

      <p></p>
      <p class="para">
       * - Supported Values are dependent on methods supported by underlying library.
       See <a href="http://libssh2.org/" class="link external">»&nbsp;libssh2</a> documentation for additional
       information.
      </p>
      <p class="para">
       </p><table class="doctable table">
        <caption><strong>
         <code class="parameter">client_to_server</code> and
         <code class="parameter">server_to_client</code> may be an associative array
         with any or all of the following parameters.
        </strong></caption>
        
         <thead>
          <tr>
           <th>Index</th>
           <th>Meaning</th>
           <th>Supported Values*</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td>crypt</td>
           <td>List of crypto methods to advertise, comma separated
            in order of preference.</td>
           <td>
            <code class="literal">rijndael-cbc@lysator.liu.se</code>,
            <code class="literal">aes256-cbc</code>,
            <code class="literal">aes192-cbc</code>,
            <code class="literal">aes128-cbc</code>,
            <code class="literal">3des-cbc</code>,
            <code class="literal">blowfish-cbc</code>,
            <code class="literal">cast128-cbc</code>,
            <code class="literal">arcfour</code>, and
            <code class="literal">none**</code>
           </td>
          </tr>

          <tr>
           <td>comp</td>
           <td>List of compression methods to advertise, comma separated
            in order of preference.</td>
           <td>
            <code class="literal">zlib</code> and
            <code class="literal">none</code>
           </td>
          </tr>

          <tr>
           <td>mac</td>
           <td>List of MAC methods to advertise, comma separated
            in order of preference.</td>
           <td>
            <code class="literal">hmac-sha1</code>,
            <code class="literal">hmac-sha1-96</code>,
            <code class="literal">hmac-ripemd160</code>,
            <code class="literal">hmac-ripemd160@openssh.com</code>, and
            <code class="literal">none**</code>
           </td>
          </tr>

         </tbody>
        
       </table>

      <p></p>
      <p class="para">
       </p><blockquote class="note"><p><strong class="note">Note</strong>: 
        <strong>Crypt and MAC method "<code class="literal">none</code>"</strong><br>
        </p><p class="para">
         For security reasons, <code class="literal">none</code> is disabled by the underlying
         <a href="http://libssh2.org/" class="link external">»&nbsp;libssh2</a> library unless explicitly enabled
         during build time by using the appropriate ./configure options.  See documentation
         for the underlying library for more information.
        </p>
       <p></p></blockquote>
      <p></p>
     </dd>

    
    
     <dt>
<code class="parameter">callbacks</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">callbacks</code> may be an associative array with any
       or all of the following parameters.
       </p><table class="doctable table">
        <caption><strong>
         Callbacks parameters
        </strong></caption>
        
         <thead>
          <tr>
           <th>Index</th>
           <th>Meaning</th>
           <th>Prototype</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td>ignore</td>
           <td>
            Name of function to call when an
            <strong><code>SSH2_MSG_IGNORE</code></strong> packet is received
           </td>
           <td>void ignore_cb($message)</td>
          </tr>

          <tr>
           <td>debug</td>
           <td>
            Name of function to call when an
            <strong><code>SSH2_MSG_DEBUG</code></strong> packet is received
           </td>
           <td>void debug_cb($message, $language, $always_display)</td>
          </tr>

          <tr>
           <td>macerror</td>
           <td>
            Name of function to call when a packet is received but the
            message authentication code failed.  If the callback returns
            <strong><code>true</code></strong>, the mismatch will be ignored, otherwise the connection
            will be terminated.
           </td>
           <td>bool macerror_cb($packet)</td>
          </tr>

          <tr>
           <td>disconnect</td>
           <td>
            Name of function to call when an
            <strong><code>SSH2_MSG_DISCONNECT</code></strong> packet is received
           </td>
           <td>void disconnect_cb($reason, $message, $language)</td>
          </tr>

         </tbody>
        
       </table>

      <p></p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.ssh2-connect-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns a resource on success, or <strong><code>false</code></strong> on error.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.ssh2-connect-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-4492">
    <p><strong>Example #1 <span class="function"><strong>ssh2_connect()</strong></span> example</strong></p>
    <div class="example-contents"><p>
     Open a connection forcing 3des-cbc when sending packets, any strength
     aes cipher when receiving packets, no compression in either direction,
     and Group1 key exchange.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">/*&nbsp;Notify&nbsp;the&nbsp;user&nbsp;if&nbsp;the&nbsp;server&nbsp;terminates&nbsp;the&nbsp;connection&nbsp;*/<br></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">my_ssh_disconnect</span><span style="color: #007700">(</span><span style="color: #0000BB">$reason</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$message</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$language</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Server&nbsp;disconnected&nbsp;with&nbsp;reason&nbsp;code&nbsp;[%d]&nbsp;and&nbsp;message:&nbsp;%s\n"</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$reason</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$message</span><span style="color: #007700">);<br>}<br><br></span><span style="color: #0000BB">$methods&nbsp;</span><span style="color: #007700">=&nbsp;array(<br>&nbsp;&nbsp;</span><span style="color: #DD0000">'kex'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'diffie-hellman-group1-sha1'</span><span style="color: #007700">,<br>&nbsp;&nbsp;</span><span style="color: #DD0000">'client_to_server'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'crypt'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'3des-cbc'</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'comp'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'none'</span><span style="color: #007700">),<br>&nbsp;&nbsp;</span><span style="color: #DD0000">'server_to_client'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'crypt'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'aes256-cbc,aes192-cbc,aes128-cbc'</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'comp'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'none'</span><span style="color: #007700">));<br><br></span><span style="color: #0000BB">$callbacks&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'disconnect'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'my_ssh_disconnect'</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ssh2_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'shell.example.com'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">22</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$methods</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$callbacks</span><span style="color: #007700">);<br>if&nbsp;(!</span><span style="color: #0000BB">$connection</span><span style="color: #007700">)&nbsp;die(</span><span style="color: #DD0000">'Connection&nbsp;failed'</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.ssh2-connect-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ssh2-fingerprint.html" class="function" rel="rdfs-seeAlso">ssh2_fingerprint()</a> - Retrieve fingerprint of remote server</span></li>
    <li class="member"><span class="function"><a href="function.ssh2-auth-none.html" class="function" rel="rdfs-seeAlso">ssh2_auth_none()</a> - Authenticate as "none"</span></li>
    <li class="member"><span class="function"><a href="function.ssh2-auth-password.html" class="function" rel="rdfs-seeAlso">ssh2_auth_password()</a> - Authenticate over SSH using a plain password</span></li>
    <li class="member"><span class="function"><a href="function.ssh2-auth-pubkey-file.html" class="function" rel="rdfs-seeAlso">ssh2_auth_pubkey_file()</a> - Authenticate using a public key</span></li>
    <li class="member"><span class="function"><a href="function.ssh2-disconnect.html" class="function" rel="rdfs-seeAlso">ssh2_disconnect()</a> - Close a connection to a remote SSH server</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="104758">  
  <a class="name">
  <strong class="user"><em>Steve Kamerman</em></strong></a><div class="date" title="2011-07-05 03:06"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom104758">
<div class="phpcode"><code><span class="html">
Due to a lack of complete examples, here's a simple SSH2 class for connecting to a server, authenticating with public key authentication, verifying the server's fingerprint, issuing commands and reading their STDOUT and properly disconnecting.&nbsp; Note: You may need to make sure you commands produce output so the response can be pulled.&nbsp; Some people suggest that the command is not executed until you pull the response back.
<br><span class="default">&lt;?php
<br></span><span class="keyword">class </span><span class="default">NiceSSH </span><span class="keyword">{
<br>&nbsp; &nbsp; </span><span class="comment">// SSH Host
<br>&nbsp; &nbsp; </span><span class="keyword">private </span><span class="default">$ssh_host </span><span class="keyword">= </span><span class="string">'myserver.example.com'</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="comment">// SSH Port
<br>&nbsp; &nbsp; </span><span class="keyword">private </span><span class="default">$ssh_port </span><span class="keyword">= </span><span class="default">22</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="comment">// SSH Server Fingerprint
<br>&nbsp; &nbsp; </span><span class="keyword">private </span><span class="default">$ssh_server_fp </span><span class="keyword">= </span><span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="comment">// SSH Username
<br>&nbsp; &nbsp; </span><span class="keyword">private </span><span class="default">$ssh_auth_user </span><span class="keyword">= </span><span class="string">'username'</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="comment">// SSH Public Key File
<br>&nbsp; &nbsp; </span><span class="keyword">private </span><span class="default">$ssh_auth_pub </span><span class="keyword">= </span><span class="string">'/home/username/.ssh/id_rsa.pub'</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="comment">// SSH Private Key File
<br>&nbsp; &nbsp; </span><span class="keyword">private </span><span class="default">$ssh_auth_priv </span><span class="keyword">= </span><span class="string">'/home/username/.ssh/id_rsa'</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="comment">// SSH Private Key Passphrase (null == no passphrase)
<br>&nbsp; &nbsp; </span><span class="keyword">private </span><span class="default">$ssh_auth_pass</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="comment">// SSH Connection
<br>&nbsp; &nbsp; </span><span class="keyword">private </span><span class="default">$connection</span><span class="keyword">;
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; public function </span><span class="default">connect</span><span class="keyword">() {
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connection </span><span class="keyword">= </span><span class="default">ssh2_connect</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ssh_host</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ssh_port</span><span class="keyword">))) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'Cannot connect to server'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fingerprint </span><span class="keyword">= </span><span class="default">ssh2_fingerprint</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connection</span><span class="keyword">, </span><span class="default">SSH2_FINGERPRINT_MD5 </span><span class="keyword">| </span><span class="default">SSH2_FINGERPRINT_HEX</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">strcmp</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ssh_server_fp</span><span class="keyword">, </span><span class="default">$fingerprint</span><span class="keyword">) !== </span><span class="default">0</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'Unable to verify server identity!'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">ssh2_auth_pubkey_file</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connection</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ssh_auth_user</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ssh_auth_pub</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ssh_auth_priv</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ssh_auth_pass</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'Autentication rejected by server'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; public function </span><span class="default">exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!(</span><span class="default">$stream </span><span class="keyword">= </span><span class="default">ssh2_exec</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connection</span><span class="keyword">, </span><span class="default">$cmd</span><span class="keyword">))) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'SSH command failed'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">$buf </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="default">$buf</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$data</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; public function </span><span class="default">disconnect</span><span class="keyword">() {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">exec</span><span class="keyword">(</span><span class="string">'echo "EXITING" &amp;&amp; exit;'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connection </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; public function </span><span class="default">__destruct</span><span class="keyword">() {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">disconnect</span><span class="keyword">();
<br>&nbsp; &nbsp; }
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>[EDIT BY danbrown AT php DOT net: Contains two bugfixes suggested by 'AlainC' in user note #109185 (removed) on 26-JUN-2012.]</span>
</code></div>
  </div>
 </div>
  <div class="note" id="116649">  
  <a class="name">
  <strong class="user"><em>thessoro at gmail dot com</em></strong></a><div class="date" title="2015-02-04 07:38"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom116649">
<div class="phpcode"><code><span class="html">
Be careful when providing a specific hostkey order. <br><br><span class="default">&lt;?php<br>ssh2_connect</span><span class="keyword">(</span><span class="string">'IP'</span><span class="keyword">, </span><span class="string">'port'</span><span class="keyword">, array(</span><span class="string">'hostkey'</span><span class="keyword">=&gt;</span><span class="string">'ssh-rsa, ssh-dss'</span><span class="keyword">));<br></span><span class="default">?&gt;<br></span><br>Will only work when the public key of the server is RSA, and not DSA also as expected. This is caused by the empty space before the "ssh-dss". <br><br>So a similar code:<br><br><span class="default">&lt;?php<br>ssh2_connect</span><span class="keyword">(</span><span class="string">'IP'</span><span class="keyword">, </span><span class="string">'port'</span><span class="keyword">,&nbsp;&nbsp; array(</span><span class="string">'hostkey'</span><span class="keyword">=&gt;</span><span class="string">'ssh-rsa,ssh-dss'</span><span class="keyword">));<br></span><span class="default">?&gt;<br></span><br>Will work. The HOSTKEY method is overriden using exactly what you write, so no empty spaces are allowed.<br><br>This took me some time that you could save ;)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="121969">  
  <a class="name">
  <strong class="user"><em>christophermjgray at gmail dot com</em></strong></a><div class="date" title="2017-12-02 10:01"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom121969">
<div class="phpcode"><code><span class="html">
This page is out of date.&nbsp; Any of the SHA-1 in the Key Exchange Methods in the kex section should be discarded, due to Logjam (<a rel="nofollow" target="_blank">https://weakdh.org/logjam.html</a>).&nbsp; If you continue to use them, connects will result in the following warning: <br>"Warning: ssh2_connect(): Error starting up SSH connection(-5): Unable to exchange encryption keys in ..."<br><br>The following is an example of what works.&nbsp; Also by removing the 'hex' section all together, results in libssl (<a rel="nofollow" target="_blank">https://libssh2.org/</a>) falling back to discovering which is the strongest cipher to authenticate with. <br><br><span class="default">&lt;?php<br><br></span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"ssh2_connect"</span><span class="keyword">)) die(</span><span class="string">"function ssh2_connect doesn't exist"</span><span class="keyword">);<br><br>function </span><span class="default">ssh2_debug</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">, </span><span class="default">$language</span><span class="keyword">, </span><span class="default">$always_display</span><span class="keyword">) {<br>&nbsp;&nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">"%s %s %s\n"</span><span class="keyword">,</span><span class="default">$message</span><span class="keyword">,</span><span class="default">$language</span><span class="keyword">,</span><span class="default">$always_display</span><span class="keyword">);<br>}<br><br></span><span class="comment">/* Notify the user if the server terminates the connection */<br></span><span class="keyword">function </span><span class="default">my_ssh_disconnect</span><span class="keyword">(</span><span class="default">$reason</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$language</span><span class="keyword">) {<br>&nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">"Server disconnected with reason code [%d] and message: %s\n"</span><span class="keyword">, </span><span class="default">$reason</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">);<br>}<br><br></span><span class="default">$methods </span><span class="keyword">= array(<br>&nbsp; &nbsp; </span><span class="string">'hostkey'</span><span class="keyword">=&gt;</span><span class="string">'ssh-rsa,ssh-dss'</span><span class="keyword">,<br></span><span class="comment">//&nbsp; &nbsp; 'kex' =&gt; 'diffie-hellman-group-exchange-sha256',<br>&nbsp; &nbsp; </span><span class="string">'client_to_server' </span><span class="keyword">=&gt; array(<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'crypt' </span><span class="keyword">=&gt; </span><span class="string">'aes256-ctr,aes192-ctr,aes128-ctr,aes256-cbc,aes192-cbc,aes128-cbc,3des-cbc,blowfish-cbc'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'comp' </span><span class="keyword">=&gt; </span><span class="string">'none'</span><span class="keyword">),<br>&nbsp; &nbsp; </span><span class="string">'server_to_client' </span><span class="keyword">=&gt; array(<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'crypt' </span><span class="keyword">=&gt; </span><span class="string">'aes256-ctr,aes192-ctr,aes128-ctr,aes256-cbc,aes192-cbc,aes128-cbc,3des-cbc,blowfish-cbc'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'comp' </span><span class="keyword">=&gt; </span><span class="string">'none'</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; <br></span><span class="default">$callbacks </span><span class="keyword">= array(</span><span class="string">'disconnect' </span><span class="keyword">=&gt; </span><span class="string">'my_ssh_disconnect'</span><span class="keyword">);<br><br>foreach (array(</span><span class="string">'192.168.1.1'</span><span class="keyword">) as </span><span class="default">$host</span><span class="keyword">) {<br>&nbsp; </span><span class="default">$connection </span><span class="keyword">= </span><span class="default">ssh2_connect</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">22</span><span class="keyword">, </span><span class="default">$methods</span><span class="keyword">, </span><span class="default">$callbacks</span><span class="keyword">);<br>&nbsp; if (!</span><span class="default">$connection</span><span class="keyword">) die(</span><span class="string">"Connection failed:"</span><span class="keyword">);<br><br>&nbsp; </span><span class="default">ssh2_auth_password</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">'user'</span><span class="keyword">, </span><span class="string">'my_password'</span><span class="keyword">) or die(</span><span class="string">"Unable to authenticate"</span><span class="keyword">);<br>&nbsp; </span><span class="default">$stream </span><span class="keyword">= </span><span class="default">ssh2_exec</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">'free -m'</span><span class="keyword">);<br>&nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; </span><span class="default">$stream_out </span><span class="keyword">= </span><span class="default">ssh2_fetch_stream</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">SSH2_STREAM_STDIO</span><span class="keyword">);<br>&nbsp; echo </span><span class="default">stream_get_contents</span><span class="keyword">(</span><span class="default">$stream_out</span><span class="keyword">);<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="112820">  
  <a class="name">
  <strong class="user"><em>Trev White</em></strong></a><div class="date" title="2013-07-26 09:20"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom112820">
<div class="phpcode"><code><span class="html">
Hi,<br>If you are having problems with running a ssh2 session and it waits forever during the execution of stream_get_contents, it might be because the remote system has run the command and is now sitting at a # prompt waiting for the next command.&nbsp; I had this issue on a HP MSA box, here is the code to get around the issue.<br><br>Assuming you are connected with your authentication method and $ssh contains the handle.<br><br><span class="default">&lt;?php<br>$command </span><span class="keyword">= </span><span class="string">"check disk"</span><span class="keyword">;<br></span><span class="comment">// Open a nice large window to stop wrapping<br></span><span class="default">$stream </span><span class="keyword">= </span><span class="default">ssh2_shell </span><span class="keyword">(</span><span class="default">$ssh</span><span class="keyword">, </span><span class="string">'xterm'</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">200</span><span class="keyword">, </span><span class="default">200</span><span class="keyword">, </span><span class="default">SSH2_TERM_UNIT_CHARS</span><span class="keyword">); <br><br></span><span class="comment">// Hook into the error stream<br></span><span class="default">$errorStream </span><span class="keyword">= </span><span class="default">ssh2_fetch_stream</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">SSH2_STREAM_STDERR</span><span class="keyword">);&nbsp; <br><br></span><span class="comment">// Block the streams so we wait until they complete<br></span><span class="default">stream_set_blocking </span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br></span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$errorStream</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br><br></span><span class="comment">// Send the commands to the terminal<br></span><span class="default">fwrite </span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">$command </span><span class="keyword">. </span><span class="default">PHP_EOL </span><span class="keyword">);<br><br></span><span class="comment">// Wait give the terminal a chance to accept and start processing the command, this is a slow storage device after all<br></span><span class="default">sleep</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">);<br><br></span><span class="comment">// IMPORTANT BIT!!&nbsp; Send exit to the terminal to close the connection BEFORE WE WAIT FOR THE STREAM<br></span><span class="default">fwrite </span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="string">"exit" </span><span class="keyword">. </span><span class="default">PHP_EOL </span><span class="keyword">);<br></span><span class="default">sleep </span><span class="keyword">(</span><span class="default">2</span><span class="keyword">);<br><br></span><span class="comment">// Print the output<br></span><span class="keyword">echo </span><span class="default">stream_get_contents</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">);<br></span><span class="default">$errortext</span><span class="keyword">=</span><span class="default">stream_get_contents</span><span class="keyword">(</span><span class="default">$errorStream</span><span class="keyword">);<br><br>if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$errortext</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Error Data<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"Error Data: </span><span class="default">$errortext</span><span class="string">"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit (</span><span class="default">1</span><span class="keyword">);<br>}<br><br></span><span class="comment">// All Good<br></span><span class="keyword">exit (</span><span class="default">0</span><span class="keyword">);<br><br></span><span class="default">?&gt;<br></span><br>You can't use ssh2_exec with this method (well at lease I couldn't) because on executing the first command the stream gets blocked and then you can't run the exit command, whereas a terminal seems to use one session.<br><br>I hope this helps someone.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="124713">  
  <a class="name">
  <strong class="user"><em>jrdbrndt at gmail dot com</em></strong></a><div class="date" title="2020-02-13 03:40"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom124713">
<div class="phpcode"><code><span class="html">
Trying to include "aes256-cbc" in the encryption methods list caused an error. The documentation here may be out of date, and you might find a more accurate list of what values are acceptable by checking the libssh2 documentation at libssh2.org.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="50311">  
  <a class="name">
  <strong class="user"><em>suri dot suribala dot com</em></strong></a><div class="date" title="2005-02-24 05:00"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom50311">
<div class="phpcode"><code><span class="html">
With Sara's help, I have the following SS2 class that is quite flexible. If anyone improves it, please feel free to let me know.<br><br><span class="default">&lt;?php<br><br></span><span class="comment">// ssh protocols<br>// note: once openShell method is used, cmdExec does not work<br><br></span><span class="keyword">class </span><span class="default">ssh2 </span><span class="keyword">{<br><br>&nbsp; private </span><span class="default">$host </span><span class="keyword">= </span><span class="string">'host'</span><span class="keyword">;<br>&nbsp; private </span><span class="default">$user </span><span class="keyword">= </span><span class="string">'user'</span><span class="keyword">;<br>&nbsp; private </span><span class="default">$port </span><span class="keyword">= </span><span class="string">'22'</span><span class="keyword">;<br>&nbsp; private </span><span class="default">$password </span><span class="keyword">= </span><span class="string">'password'</span><span class="keyword">;<br>&nbsp; private </span><span class="default">$con </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>&nbsp; private </span><span class="default">$shell_type </span><span class="keyword">= </span><span class="string">'xterm'</span><span class="keyword">;<br>&nbsp; private </span><span class="default">$shell </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>&nbsp; private </span><span class="default">$log </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br><br>&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">=</span><span class="string">''&nbsp; </span><span class="keyword">) {<br><br>&nbsp; &nbsp;&nbsp; if( </span><span class="default">$host</span><span class="keyword">!=</span><span class="string">'' </span><span class="keyword">) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">host&nbsp; </span><span class="keyword">= </span><span class="default">$host</span><span class="keyword">;<br>&nbsp; &nbsp;&nbsp; if( </span><span class="default">$port</span><span class="keyword">!=</span><span class="string">'' </span><span class="keyword">) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">port&nbsp; </span><span class="keyword">= </span><span class="default">$port</span><span class="keyword">;<br><br>&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">con&nbsp; </span><span class="keyword">= </span><span class="default">ssh2_connect</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">host</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">port</span><span class="keyword">);<br>&nbsp; &nbsp;&nbsp; if( !</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">con </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">log </span><span class="keyword">.= </span><span class="string">"Connection failed !"</span><span class="keyword">; <br>&nbsp; &nbsp;&nbsp; }<br><br>&nbsp; }<br><br>&nbsp; function </span><span class="default">authPassword</span><span class="keyword">( </span><span class="default">$user </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">, </span><span class="default">$password </span><span class="keyword">= </span><span class="string">'' </span><span class="keyword">) {<br><br>&nbsp; &nbsp;&nbsp; if( </span><span class="default">$user</span><span class="keyword">!=</span><span class="string">'' </span><span class="keyword">) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">user&nbsp; </span><span class="keyword">= </span><span class="default">$user</span><span class="keyword">;<br>&nbsp; &nbsp;&nbsp; if( </span><span class="default">$password</span><span class="keyword">!=</span><span class="string">'' </span><span class="keyword">) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">password&nbsp; </span><span class="keyword">= </span><span class="default">$password</span><span class="keyword">;<br><br>&nbsp; &nbsp;&nbsp; if( !</span><span class="default">ssh2_auth_password</span><span class="keyword">( </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">con</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">user</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">password </span><span class="keyword">) ) {<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">log </span><span class="keyword">.= </span><span class="string">"Authorization failed !"</span><span class="keyword">; <br>&nbsp; &nbsp;&nbsp; }<br><br>&nbsp; }<br><br>&nbsp; function </span><span class="default">openShell</span><span class="keyword">( </span><span class="default">$shell_type </span><span class="keyword">= </span><span class="string">'' </span><span class="keyword">) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">$shell_type </span><span class="keyword">!= </span><span class="string">'' </span><span class="keyword">) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shell_type </span><span class="keyword">= </span><span class="default">$shell_type</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shell </span><span class="keyword">= </span><span class="default">ssh2_shell</span><span class="keyword">( </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">con</span><span class="keyword">,&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shell_type </span><span class="keyword">);<br>&nbsp; &nbsp; if( !</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shell </span><span class="keyword">) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">log </span><span class="keyword">.= </span><span class="string">" Shell connection failed !"</span><span class="keyword">;<br><br>&nbsp; }<br><br>&nbsp; function </span><span class="default">writeShell</span><span class="keyword">( </span><span class="default">$command </span><span class="keyword">= </span><span class="string">'' </span><span class="keyword">) {<br><br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shell</span><span class="keyword">, </span><span class="default">$command</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">);<br><br>&nbsp; }<br><br>&nbsp; function </span><span class="default">cmdExec</span><span class="keyword">( ) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$argc </span><span class="keyword">= </span><span class="default">func_num_args</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$argv </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br><br>&nbsp; &nbsp; </span><span class="default">$cmd </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; for( </span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$argc </span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">$i </span><span class="keyword">!= (</span><span class="default">$argc</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">) ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cmd </span><span class="keyword">.= </span><span class="default">$argv</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="string">" &amp;&amp; "</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }else{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cmd </span><span class="keyword">.= </span><span class="default">$argv</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; echo </span><span class="default">$cmd</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$stream </span><span class="keyword">= </span><span class="default">ssh2_exec</span><span class="keyword">( </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">con</span><span class="keyword">, </span><span class="default">$cmd </span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">( </span><span class="default">$stream</span><span class="keyword">, </span><span class="default">true </span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">fread</span><span class="keyword">( </span><span class="default">$stream</span><span class="keyword">, </span><span class="default">4096 </span><span class="keyword">);<br><br>&nbsp; }<br><br>&nbsp; function </span><span class="default">getLog</span><span class="keyword">() {<br><br>&nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">log</span><span class="keyword">; <br><br>&nbsp; }<br><br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="115172">  
  <a class="name">
  <strong class="user"><em>rainerkrauss at googlemail dot com</em></strong></a><div class="date" title="2014-06-08 11:00"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom115172">
<div class="phpcode"><code><span class="html">
Warning! If you open a ssh connection and execute an external program opening another ssh connection it may result in very strange behavior.<br><br>I used an sftp connection to get a file list and used "exec" to download the files afterwards with an external sftp. lftp downloaded zeros with no comment, psftp exits with error code 11 most of the time, but sometimes it works - probably depending on how quickly php collects garbage and closes the unused connection first.<br><br>As there is no function to close a connection, you need to be sure to destroy all references (unset) to close it.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->

  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from www.php.net/manual/en/function.ssh2-connect.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Sep 2021 06:31:36 GMT -->

</body></html>