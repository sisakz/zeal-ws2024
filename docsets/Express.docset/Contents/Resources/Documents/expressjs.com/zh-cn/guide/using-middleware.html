<!DOCTYPE html>

<html lang="zh-cn" prefix="og: http://ogp.me/ns#">

<!-- Mirrored from expressjs.com/zh-cn/guide/using-middleware.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 10 Jul 2019 00:23:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<title>ä½¿ç”¨ Express ä¸­é—´ä»¶</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="og:image" content="../../images/express-facebook-share.png">
<link rel="icon" type="image/png" href="../../images/favicon.png" />
<link rel="stylesheet" href="../../css/style.css">
<link rel="stylesheet" href="../../css/dropit.css">
<link rel="stylesheet" href="../../css/prism.css">
<link rel="stylesheet" href="../../css/font-awesome.min.css">
<link rel="stylesheet" href="../../../fonts.googleapis.com/css2a1d.css?family=Open+Sans:300,400,600,700&amp;amp;subset=latin,latin-ext">
<link rel="stylesheet" href="../../css/zh-cn.css">
<link rel="stylesheet" href="../../css/nodeinteractive.css">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script data-cfasync="false" src="../../../ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script data-cfasync="false" src="../../js/ismobile.js"></script>
<script data-cfasync="false" src="../../js/app.js"></script>
<script data-cfasync="false" src="../../js/retina.js"></script>
<script data-cfasync="false" src="../../js/dropit.js"></script>
<script data-cfasync="false" src="../../js/prism.js"></script>
<link rel="stylesheet" href="../../../cdn.jsdelivr.net/npm/docsearch.js%402/dist/cdn/docsearch.min.css" />
</head>
<body class="non-en-doc">
<section class="page content">
<header>
<div id="mobile-menu">
<div id="nav-button" class="fa fa-bars fa-2x button"></div>
</div>
<section id="logo"><a href="../../index.html" class="express">Express</a>
</section>
<div id="navbar">
<input id="q" placeholder="ğŸ” search">
<ul id="navmenu">
<li><a href="../index.html" id="home-menu">ä¸»é¡µ</a></li>
<li>
<ul id="getting-started-menu" class="menu">
<li><a href="../starter/installing.html">å…¥é—¨</a>
<ul>
<li>
<a href="../starter/installing.html">
å®‰è£…
</a>
</li>
<li>
<a href="../starter/hello-world.html">
Hello world
</a>
</li>
<li>
<a href="../starter/generator.html">
Express ç”Ÿæˆå™¨
</a>
</li>
<li>
<a href="../starter/basic-routing.html">
åŸºæœ¬è·¯ç”±
</a>
</li>
<li>
<a href="../starter/static-files.html">
é™æ€æ–‡ä»¶
</a>
</li>
<li>
<a href="../starter/faq.html">
å¸¸è§é—®é¢˜åŠè§£ç­”
</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="guide-menu" class="menu">
<li><a href="routing.html" class="active">æŒ‡å—</a>
<ul>
<li><a href="routing.html">è·¯ç”±</a>
</li>
<li><a href="writing-middleware.html">ç¼–å†™ä¸­é—´ä»¶</a>
</li>
<li><a href="using-middleware.html">ä½¿ç”¨ä¸­é—´ä»¶</a>
 </li>
<li><a href="using-template-engines.html">ä½¿ç”¨æ¨¡æ¿å¼•æ“</a>
</li>
<li><a href="error-handling.html">é”™è¯¯å¤„ç†</a>
</li>
<li><a href="debugging.html">è°ƒè¯•</a>
</li>
<li><a href="behind-proxies.html">ä»£ç†èƒŒåçš„ Express</a>
</li>
<li><a href="migrating-4.html">è¿ç§»åˆ° Express 4</a>
</li>
<li><a href="migrating-5.html">è¿ç§»åˆ° Express 5</a>
</li>
<li><a href="database-integration.html">æ•°æ®åº“é›†æˆ</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="application-menu" class="menu">
<li><a href="../4x/api.html">API å‚è€ƒ</a>
<ul>
<li><a href="../4x/api.html">4.x</a>
</li>
<li><a href="../3x/api.html">3.xï¼ˆä¸æ¨èï¼‰</a>
</li>
<li><a href="../../2x/index.html">2.xï¼ˆä¸æ¨èï¼‰</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="advanced-topics-menu" class="menu">
<li><a href="../advanced/developing-template-engines.html">é«˜çº§ä¸»é¢˜</a>
<ul>
<li><a href="../advanced/developing-template-engines.html">æ¨¡æ¿å¼•æ“</a>
</li>
<li><a href="../advanced/pm.html">ä½¿ç”¨è¿›ç¨‹ç®¡ç†å™¨</a>
</li>
<li><a href="../advanced/security-updates.html">å®‰å…¨æ›´æ–°</a>
</li>
<li><a href="../advanced/best-practice-security.html">å®‰å…¨æœ€ä½³å®è·µ</a>
</li>
<li><a href="../advanced/best-practice-performance.html">æ€§èƒ½æœ€ä½³å®è·µ</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="resources-menu" class="menu">
<li><a href="../resources/glossary.html">èµ„æº</a>
<ul>
<li><a href="../resources/glossary.html">è¯æ±‡è¡¨</a>
</li>
<li><a href="../resources/middleware.html">ä¸­é—´ä»¶</a>
</li>
<li><a href="../resources/community.html">ç¤¾åŒº</a>
</li>
<li><a href="../resources/books-blogs.html">ä¹¦ç±å’Œåšå®¢</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</header>
<div id="overlay"></div>
<div id="i18n-notice-box" class="doc-box doc-warn">
<p><p>è¿™ä¸ªç¿»è¯‘<a href="http://strongloop.com/">StrongLoop / IBM</a>æä¾›.</p>
ç›¸å¯¹äºè‹±æ–‡ç‰ˆçš„æ–‡æ¡£ï¼Œæœ¬æ–‡æ¡£å¯èƒ½å·²è¿‡æ—¶ã€‚è¦äº†è§£æœ€è¿‘çš„æ›´æ–°ï¼Œè¯·å‚é˜…<a href="../../index.html">è‹±æ–‡ç‰ˆæ–‡æ¡£</a>ã€‚
</p>
<div id="close-i18n-notice-box" title="Close">âœ–</div>
</div>
<div id="page-doc" markdown="1">
<h1 id="ä½¿ç”¨ä¸­é—´ä»¶">ä½¿ç”¨ä¸­é—´ä»¶</h1>
<p>Express æ˜¯ä¸€ä¸ªè·¯ç”±å’Œä¸­é—´ä»¶ Web æ¡†æ¶ï¼Œå…¶è‡ªèº«åªå…·æœ‰æœ€ä½ç¨‹åº¦çš„åŠŸèƒ½ï¼šExpress åº”ç”¨ç¨‹åºåŸºæœ¬ä¸Šæ˜¯ä¸€ç³»åˆ—ä¸­é—´ä»¶å‡½æ•°è°ƒç”¨ã€‚</p>
<p><em>ä¸­é—´ä»¶</em>å‡½æ•°èƒ½å¤Ÿè®¿é—®<a href="../4x/api.html#req">è¯·æ±‚å¯¹è±¡</a> (<code>req</code>)ã€<a href="../4x/api.html#res">å“åº”å¯¹è±¡</a> (<code>res</code>) ä»¥åŠåº”ç”¨ç¨‹åºçš„è¯·æ±‚/å“åº”å¾ªç¯ä¸­çš„ä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ã€‚ä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°é€šå¸¸ç”±åä¸º <code>next</code> çš„å˜é‡æ¥è¡¨ç¤ºã€‚</p>
<p>ä¸­é—´ä»¶å‡½æ•°å¯ä»¥æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š</p>
<ul>
<li>æ‰§è¡Œä»»ä½•ä»£ç ã€‚</li>
<li>å¯¹è¯·æ±‚å’Œå“åº”å¯¹è±¡è¿›è¡Œæ›´æ”¹ã€‚</li>
<li>ç»“æŸè¯·æ±‚/å“åº”å¾ªç¯ã€‚</li>
<li>è°ƒç”¨å †æ ˆä¸­çš„ä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ã€‚</li>
</ul>
<p>å¦‚æœå½“å‰ä¸­é—´ä»¶å‡½æ•°æ²¡æœ‰ç»“æŸè¯·æ±‚/å“åº”å¾ªç¯ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»è°ƒç”¨ <code>next()</code>ï¼Œä»¥å°†æ§åˆ¶æƒä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ã€‚å¦åˆ™ï¼Œè¯·æ±‚å°†ä¿æŒæŒ‚èµ·çŠ¶æ€ã€‚</p>
<p>Express åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç±»å‹çš„ä¸­é—´ä»¶ï¼š</p>
<ul>
<li><a href="#middleware.application">åº”ç”¨å±‚ä¸­é—´ä»¶</a></li>
<li><a href="#middleware.router">è·¯ç”±å™¨å±‚ä¸­é—´ä»¶</a></li>
<li><a href="#middleware.error-handling">é”™è¯¯å¤„ç†ä¸­é—´ä»¶</a></li>
<li><a href="#middleware.built-in">å†…ç½®ä¸­é—´ä»¶</a></li>
<li><a href="#middleware.third-party">ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶</a></li>
</ul>
<p>æ‚¨å¯ä»¥ä½¿ç”¨å¯é€‰å®‰è£…è·¯å¾„æ¥è£…å…¥åº”ç”¨å±‚å’Œè·¯ç”±å™¨å±‚ä¸­é—´ä»¶ã€‚
è¿˜å¯ä»¥å°†ä¸€ç³»åˆ—ä¸­é—´ä»¶å‡½æ•°ä¸€èµ·è£…å…¥ï¼Œè¿™æ ·ä¼šåœ¨å®‰è£…ç‚¹åˆ›å»ºä¸­é—´ä»¶ç³»ç»Ÿçš„å­å †æ ˆã€‚</p>
<h2 id="middleware.application">åº”ç”¨å±‚ä¸­é—´ä»¶</h2>
<p>ä½¿ç”¨ <code>app.use()</code> å’Œ <code>app.METHOD()</code> å‡½æ•°å°†åº”ç”¨å±‚ä¸­é—´ä»¶ç»‘å®šåˆ°<a href="../4x/api.html#app">åº”ç”¨ç¨‹åºå¯¹è±¡</a>çš„å®ä¾‹ï¼Œå…¶ä¸­ <code>METHOD</code> æ˜¯ä¸­é—´ä»¶å‡½æ•°å¤„ç†çš„è¯·æ±‚çš„å°å†™ HTTP æ–¹æ³•ï¼ˆä¾‹å¦‚ GETã€PUT æˆ– POSTï¼‰ã€‚</p>
<p>æ­¤ç¤ºä¾‹æ˜¾ç¤ºæ²¡æœ‰å®‰è£…è·¯å¾„çš„ä¸­é—´ä»¶å‡½æ•°ã€‚åº”ç”¨ç¨‹åºæ¯æ¬¡æ”¶åˆ°è¯·æ±‚æ—¶æ‰§è¡Œè¯¥å‡½æ•°ã€‚</p>
<pre><code class="language-javascript" translate="no">
var app = express();

app.use(function (req, res, next) {
  console.log('Time:', Date.now());
  next();
});
</code>
</pre>
<p>æ­¤ç¤ºä¾‹æ˜¾ç¤ºå®‰è£…åœ¨ <code>/user/:id</code> è·¯å¾„ä¸­çš„ä¸­é—´ä»¶å‡½æ•°ã€‚åœ¨ <code>/user/:id</code> è·¯å¾„ä¸­ä¸ºä»»ä½•ç±»å‹çš„ HTTP è¯·æ±‚æ‰§è¡Œæ­¤å‡½æ•°ã€‚</p>
<pre><code class="language-javascript" translate="no">
app.use('/user/:id', function (req, res, next) {
  console.log('Request Type:', req.method);
  next();
});
</code>
</pre>
<p>æ­¤ç¤ºä¾‹æ˜¾ç¤ºä¸€ä¸ªè·¯ç”±åŠå…¶å¤„ç†ç¨‹åºå‡½æ•°ï¼ˆä¸­é—´ä»¶ç³»ç»Ÿï¼‰ã€‚æ­¤å‡½æ•°å¤„ç†é’ˆå¯¹ <code>/user/:id</code> è·¯å¾„çš„ GET è¯·æ±‚ã€‚</p>
<pre><code class="language-javascript" translate="no">
app.get('/user/:id', function (req, res, next) {
  res.send('USER');
});
</code>
</pre>
<p>ä»¥ä¸‹æ˜¯åœ¨å®‰è£…ç‚¹ä½¿ç”¨å®‰è£…è·¯å¾„è£…å…¥ä¸€ç³»åˆ—ä¸­é—´ä»¶å‡½æ•°çš„ç¤ºä¾‹ã€‚
å®ƒæ¼”ç¤ºä¸€ä¸ªä¸­é—´ä»¶å­å †æ ˆï¼Œç”¨äºæ˜¾ç¤ºé’ˆå¯¹ <code>/user/:id</code> è·¯å¾„çš„ä»»ä½•ç±»å‹ HTTP è¯·æ±‚çš„ä¿¡æ¯ã€‚</p>
<pre><code class="language-javascript" translate="no">
app.use('/user/:id', function(req, res, next) {
  console.log('Request URL:', req.originalUrl);
  next();
}, function (req, res, next) {
  console.log('Request Type:', req.method);
  next();
});
</code>
</pre>
<p>è·¯ç”±å¤„ç†ç¨‹åºä½¿æ‚¨å¯ä»¥ä¸ºä¸€ä¸ªè·¯å¾„å®šä¹‰å¤šä¸ªè·¯ç”±ã€‚ä»¥ä¸‹ç¤ºä¾‹ä¸ºé’ˆå¯¹ <code>/user/:id</code> è·¯å¾„çš„ GET è¯·æ±‚å®šä¹‰ä¸¤ä¸ªè·¯ç”±ã€‚ç¬¬äºŒä¸ªè·¯ç”±ä¸ä¼šå¯¼è‡´ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯æ°¸è¿œéƒ½ä¸ä¼šè¢«è°ƒç”¨ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªè·¯ç”±ç»“æŸäº†è¯·æ±‚/å“åº”å¾ªç¯ã€‚</p>
<p>æ­¤ç¤ºä¾‹æ˜¾ç¤ºä¸€ä¸ªä¸­é—´ä»¶å­å †æ ˆï¼Œç”¨äºå¤„ç†é’ˆå¯¹ <code>/user/:id</code> è·¯å¾„çš„ GET è¯·æ±‚ã€‚</p>
<pre><code class="language-javascript" translate="no">
app.get('/user/:id', function (req, res, next) {
  console.log('ID:', req.params.id);
  next();
}, function (req, res, next) {
  res.send('User Info');
});

// handler for the /user/:id path, which prints the user ID
app.get('/user/:id', function (req, res, next) {
  res.end(req.params.id);
});
</code>
</pre>
<p>è¦è·³è¿‡è·¯ç”±å™¨ä¸­é—´ä»¶å †æ ˆä¸­å‰©ä½™çš„ä¸­é—´ä»¶å‡½æ•°ï¼Œè¯·è°ƒç”¨ <code>next('route')</code> å°†æ§åˆ¶æƒä¼ é€’ç»™ä¸‹ä¸€ä¸ªè·¯ç”±ã€‚
<strong>æ³¨</strong>ï¼š<code>next('route')</code> ä»…åœ¨ä½¿ç”¨ <code>app.METHOD()</code> æˆ– <code>router.METHOD()</code> å‡½æ•°è£…å…¥çš„ä¸­é—´ä»¶å‡½æ•°ä¸­æœ‰æ•ˆã€‚</p>
<p>æ­¤ç¤ºä¾‹æ˜¾ç¤ºä¸€ä¸ªä¸­é—´ä»¶å­å †æ ˆï¼Œç”¨äºå¤„ç†é’ˆå¯¹ <code>/user/:id</code> è·¯å¾„çš„ GET è¯·æ±‚ã€‚</p>
<pre><code class="language-javascript" translate="no">
app.get('/user/:id', function (req, res, next) {
  // if the user ID is 0, skip to the next route
  if (req.params.id == 0) next('route');
  // otherwise pass the control to the next middleware function in this stack
  else next(); //
}, function (req, res, next) {
  // render a regular page
  res.render('regular');
});

// handler for the /user/:id path, which renders a special page
app.get('/user/:id', function (req, res, next) {
  res.render('special');
});
</code>
</pre>
<h2 id="middleware.router">è·¯ç”±å™¨å±‚ä¸­é—´ä»¶</h2>
<p>è·¯ç”±å™¨å±‚ä¸­é—´ä»¶çš„å·¥ä½œæ–¹å¼ä¸åº”ç”¨å±‚ä¸­é—´ä»¶åŸºæœ¬ç›¸åŒï¼Œå·®å¼‚ä¹‹å¤„åœ¨äºå®ƒç»‘å®šåˆ° <code>express.Router()</code> çš„å®ä¾‹ã€‚</p>
<pre><code class="language-javascript" translate="no">
var router = express.Router();
</code>
</pre>
<p>ä½¿ç”¨ <code>router.use()</code> å’Œ <code>router.METHOD()</code> å‡½æ•°è£…å…¥è·¯ç”±å™¨å±‚ä¸­é—´ä»¶ã€‚
ä»¥ä¸‹ç¤ºä¾‹ä»£ç ä½¿ç”¨è·¯ç”±å™¨å±‚ä¸­é—´ä»¶å¤åˆ¶ä»¥ä¸Šä¸ºåº”ç”¨å±‚ä¸­é—´ä»¶æ˜¾ç¤ºçš„ä¸­é—´ä»¶ç³»ç»Ÿï¼š</p>
<pre><code class="language-javascript" translate="no">
var app = express();
var router = express.Router();

// a middleware function with no mount path. This code is executed for every request to the router
router.use(function (req, res, next) {
  console.log('Time:', Date.now());
  next();
});

// a middleware sub-stack shows request info for any type of HTTP request to the /user/:id path
router.use('/user/:id', function(req, res, next) {
  console.log('Request URL:', req.originalUrl);
  next();
}, function (req, res, next) {
  console.log('Request Type:', req.method);
  next();
});

// a middleware sub-stack that handles GET requests to the /user/:id path
router.get('/user/:id', function (req, res, next) {
  // if the user ID is 0, skip to the next router
  if (req.params.id == 0) next('route');
  // otherwise pass control to the next middleware function in this stack
  else next(); //
}, function (req, res, next) {
  // render a regular page
  res.render('regular');
});

// handler for the /user/:id path, which renders a special page
router.get('/user/:id', function (req, res, next) {
  console.log(req.params.id);
  res.render('special');
});

// mount the router on the app
app.use('/', router);
</code>
</pre>
<h2 id="middleware.error-handling">é”™è¯¯å¤„ç†ä¸­é—´ä»¶</h2>
<div class="doc-box doc-notice">
<p>é”™è¯¯å¤„ç†ä¸­é—´ä»¶å§‹ç»ˆé‡‡ç”¨<em>å››ä¸ª</em>è‡ªå˜é‡ã€‚å¿…é¡»æä¾›å››ä¸ªè‡ªå˜é‡ï¼Œä»¥å°†å‡½æ•°æ ‡è¯†ä¸ºé”™è¯¯å¤„ç†ä¸­é—´ä»¶å‡½æ•°ã€‚å³ä½¿æ— éœ€ä½¿ç”¨ <code>next</code> å¯¹è±¡ï¼Œä¹Ÿå¿…é¡»æŒ‡å®šè¯¥å¯¹è±¡ä»¥ä¿æŒç‰¹å¾ç¬¦çš„æœ‰æ•ˆæ€§ã€‚å¦åˆ™ï¼Œ<code>next</code> å¯¹è±¡å°†è¢«è§£é‡Šä¸ºå¸¸è§„ä¸­é—´ä»¶ï¼Œä»è€Œæ— æ³•å¤„ç†é”™è¯¯ã€‚</p>
</div>
<p>é”™è¯¯å¤„ç†ä¸­é—´ä»¶å‡½æ•°çš„å®šä¹‰æ–¹å¼ä¸å…¶ä»–ä¸­é—´ä»¶å‡½æ•°åŸºæœ¬ç›¸åŒï¼Œå·®åˆ«åœ¨äºé”™è¯¯å¤„ç†å‡½æ•°æœ‰å››ä¸ªè‡ªå˜é‡è€Œä¸æ˜¯ä¸‰ä¸ªï¼Œä¸“é—¨å…·æœ‰ç‰¹å¾ç¬¦ <code>(err, req, res, next)</code>ï¼š</p>
<pre><code class="language-javascript" translate="no">
app.use(function(err, req, res, next) {
  console.error(err.stack);
  res.status(500).send('Something broke!');
});
</code>
</pre>
<p>æœ‰å…³é”™è¯¯å¤„ç†ä¸­é—´ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ï¼š<a href="error-handling.html">é”™è¯¯å¤„ç†</a>ã€‚</p>
<h2 id="middleware.built-in">å†…ç½®ä¸­é—´ä»¶</h2>
<p>è‡ª V4.x èµ·ï¼ŒExpress ä¸å†ä¾èµ–äº <a href="https://github.com/senchalabs/connect">Connect</a>ã€‚é™¤ <code>express.static</code> å¤–ï¼Œå…ˆå‰ Express éšé™„çš„æ‰€æœ‰ä¸­é—´ä»¶å‡½æ•°ç°åœ¨ä»¥å•ç‹¬æ¨¡å—çš„å½¢å¼æä¾›ã€‚è¯·æŸ¥çœ‹<a href="https://github.com/senchalabs/connect#middleware">ä¸­é—´ä»¶å‡½æ•°çš„åˆ—è¡¨</a>ã€‚</p>
<h4 id="express.static">express.static(root, [options])</h4>
<p>Express ä¸­å”¯ä¸€å†…ç½®çš„ä¸­é—´ä»¶å‡½æ•°æ˜¯ <code>express.static</code>ã€‚æ­¤å‡½æ•°åŸºäº <a href="https://github.com/expressjs/serve-static">serve-static</a>ï¼Œè´Ÿè´£æä¾› Express åº”ç”¨ç¨‹åºçš„é™æ€èµ„æºã€‚</p>
<p><code>root</code> è‡ªå˜é‡æŒ‡å®šä»å…¶ä¸­æä¾›é™æ€èµ„æºçš„æ ¹ç›®å½•ã€‚</p>
<p>å¯é€‰çš„ <code>options</code> å¯¹è±¡å¯ä»¥å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š</p>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>æè¿°</th>
<th>ç±»å‹</th>
<th>ç¼ºçœå€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dotfiles</code></td>
<td>æ˜¯å¦å¯¹å¤–è¾“å‡ºæ–‡ä»¶åä»¥ç‚¹ï¼ˆ.ï¼‰å¼€å¤´çš„æ–‡ä»¶ã€‚æœ‰æ•ˆå€¼åŒ…æ‹¬â€œallowâ€ã€â€œdenyâ€å’Œâ€œignoreâ€</td>
<td>å­—ç¬¦ä¸²</td>
<td>â€œignoreâ€</td>
</tr>
<tr>
<td><code>etag</code></td>
<td>å¯ç”¨æˆ–ç¦ç”¨ etag ç”Ÿæˆ</td>
<td>å¸ƒå°”</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>extensions</code></td>
<td>ç”¨äºè®¾ç½®åå¤‡æ–‡ä»¶æ‰©å±•åã€‚</td>
<td>æ•°ç»„</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>index</code></td>
<td>å‘é€ç›®å½•ç´¢å¼•æ–‡ä»¶ã€‚è®¾ç½®ä¸º <code>false</code> å¯ç¦ç”¨å»ºç«‹ç›®å½•ç´¢å¼•ã€‚</td>
<td>æ··åˆ</td>
<td>â€œindex.htmlâ€</td>
</tr>
<tr>
<td><code>lastModified</code></td>
<td>å°† <code>Last-Modified</code> çš„å¤´è®¾ç½®ä¸ºæ“ä½œç³»ç»Ÿä¸Šè¯¥æ–‡ä»¶çš„ä¸Šæ¬¡ä¿®æ”¹æ—¥æœŸã€‚æœ‰æ•ˆå€¼åŒ…æ‹¬ <code>true</code> æˆ– <code>false</code>ã€‚</td>
<td>å¸ƒå°”</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>maxAge</code></td>
<td>è®¾ç½® Cache-Control å¤´çš„ max-age å±æ€§ï¼ˆä»¥æ¯«ç§’æˆ–è€… <a href="https://www.npmjs.org/package/ms">ms æ ¼å¼</a>ä¸­çš„å­—ç¬¦ä¸²ä¸ºå•ä½ï¼‰</td>
<td>æ•°å­—</td>
<td>0</td>
</tr>
<tr>
<td><code>redirect</code></td>
<td>å½“è·¯å¾„åæ˜¯ç›®å½•æ—¶é‡å®šå‘åˆ°ç»“å°¾çš„â€œ/â€ã€‚</td>
<td>å¸ƒå°”</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>setHeaders</code></td>
<td>ç”¨äºè®¾ç½®éšæ–‡ä»¶ä¸€èµ·æä¾›çš„ HTTP å¤´çš„å‡½æ•°ã€‚</td>
<td>å‡½æ•°</td>
<td>Â </td>
</tr>
</tbody>
</table>
<p>ä»¥ä¸‹ç¤ºä¾‹å°†ä½¿ç”¨äº† <code>express.static</code> ä¸­é—´ä»¶ï¼Œå¹¶ä¸”æä¾›äº†ä¸€ä¸ªè¯¦ç»†çš„â€™optionsâ€™å¯¹è±¡ï¼ˆä½œä¸ºç¤ºä¾‹ï¼‰ï¼š</p>
<pre><code class="language-javascript" translate="no">
var options = {
  dotfiles: 'ignore',
  etag: false,
  extensions: ['htm', 'html'],
  index: false,
  maxAge: '1d',
  redirect: false,
  setHeaders: function (res, path, stat) {
    res.set('x-timestamp', Date.now());
  }
}

app.use(express.static('public', options));
</code>
</pre>
<p>å¯¹äºæ¯ä¸ªåº”ç”¨ç¨‹åºï¼Œå¯ä»¥æœ‰å¤šä¸ªé™æ€ç›®å½•ï¼š</p>
<pre><code class="language-javascript" translate="no">
app.use(express.static('public'));
app.use(express.static('uploads'));
app.use(express.static('files'));
</code>
</pre>
<p>æœ‰å…³ <code>serve-static</code> å‡½æ•°åŠå…¶é€‰é¡¹çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ï¼š<a href="https://github.com/expressjs/serve-static">serve-static</a> æ–‡æ¡£ã€‚</p>
<h2 id="middleware.third-party">ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶</h2>
<p>ä½¿ç”¨ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶å‘ Express åº”ç”¨ç¨‹åºæ·»åŠ åŠŸèƒ½ã€‚</p>
<p>å®‰è£…å…·æœ‰æ‰€éœ€åŠŸèƒ½çš„ Node.js æ¨¡å—ï¼Œç„¶ååœ¨åº”ç”¨å±‚æˆ–è·¯ç”±å™¨å±‚çš„åº”ç”¨ç¨‹åºä¸­å°†å…¶åŠ è£…å…¥ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•å®‰è£…å’Œè£…å…¥ cookie è§£æä¸­é—´ä»¶å‡½æ•° <code>cookie-parser</code>ã€‚</p>
<pre><code class="language-sh" translate="no">
$ npm install cookie-parser
</code>
</pre>
<pre><code class="language-javascript" translate="no">
var express = require('express');
var app = express();
var cookieParser = require('cookie-parser');

// load the cookie-parsing middleware
app.use(cookieParser());
</code>
</pre>
<p>æœ‰å…³ Express å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶å‡½æ•°çš„éƒ¨åˆ†åˆ—è¡¨ï¼Œè¯·å‚é˜…ï¼š<a href="../resources/middleware.html">ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶</a>ã€‚</p>
</div>
</section>

<noscript>
    <iframe src="http://www.googletagmanager.com/ns.html?id=GTM-5XL76H" height="0" width="0" style="display: none; visibility: hidden;"></iframe>
</noscript>
<script type="277507adf7044e299b57ce0c-text/javascript">
(function(w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
        'gtm.start': new Date().getTime(),
        event: 'gtm.js'
    });
    var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != 'dataLayer' ? '&l=' + l : '';
    j.async = true;
    j.src =
        '../../../www.googletagmanager.com/gtm5445.js?id=' + i + dl;
    f.parentNode.insertBefore(j, f);
})(window, document, 'script', 'dataLayer', 'GTM-5XL76H');
</script>
<a id="top" href="#"><img src="../../images/arrow.png"></a>
<footer>
<div id="footer-content">
<div id="github">
<iframe src="http://ghbtns.com/github-btn.html?user=expressjs&amp;repo=express&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe>
</div>
<div id="sponsor"><a href="https://github.com/expressjs/express">Express</a>æ˜¯Node.jsçš„åŸºé‡‘ä¼šçš„ä¸€ä¸ªé¡¹ç›®</div>
<div id="fork"><a href="https://github.com/expressjs/expressjs.com">åœ¨ GitHub ä¸Šæ´¾ç”Ÿå‡ºç½‘ç«™</a>ã€‚</div>
<div>Copyright &copy; StrongLoop, Inc., and other expressjs.com contributors.</div>
</div>
<div id="license">
<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/us/"><img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®" style="border-width:0" src="../../../i.creativecommons.org/l/by-sa/3.0/us/80x15.png" /></a> æœ¬ä½œå“é‡‡ç”¨<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/us/">çŸ¥è¯†å…±äº«ç½²å-ç›¸åŒæ–¹å¼å…±äº« 3.0 ç¾å›½è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯ã€‚
</div>
</footer>
<script type="277507adf7044e299b57ce0c-text/javascript" src="../../../cdn.jsdelivr.net/npm/docsearch.js%402/dist/cdn/docsearch.min.js" onload="docsearch({
  apiKey: '7164e33055faa6ecddefd9e08fc59f5d',
  indexName: 'expressjs',
  inputSelector: '#q',
  algoliaOptions: { 'facetFilters': ['lang:zh-cn'] }
})" async></script>
<script src="../../../ajax.cloudflare.com/cdn-cgi/scripts/a2bd7673/cloudflare-static/rocket-loader.min.js" data-cf-settings="277507adf7044e299b57ce0c-|49" defer=""></script></body>

<!-- Mirrored from expressjs.com/zh-cn/guide/using-middleware.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 10 Jul 2019 00:23:49 GMT -->
</html>
