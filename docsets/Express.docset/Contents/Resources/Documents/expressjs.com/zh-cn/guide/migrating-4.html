<!DOCTYPE html>

<html lang="zh-cn" prefix="og: http://ogp.me/ns#">

<!-- Mirrored from expressjs.com/zh-cn/guide/migrating-4.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 10 Jul 2019 00:23:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<title>è¿ç§»åˆ° Express 4</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="og:image" content="../../images/express-facebook-share.png">
<link rel="icon" type="image/png" href="../../images/favicon.png" />
<link rel="stylesheet" href="../../css/style.css">
<link rel="stylesheet" href="../../css/dropit.css">
<link rel="stylesheet" href="../../css/prism.css">
<link rel="stylesheet" href="../../css/font-awesome.min.css">
<link rel="stylesheet" href="../../../fonts.googleapis.com/css2a1d.css?family=Open+Sans:300,400,600,700&amp;amp;subset=latin,latin-ext">
<link rel="stylesheet" href="../../css/zh-cn.css">
<link rel="stylesheet" href="../../css/nodeinteractive.css">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script data-cfasync="false" src="../../../ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script data-cfasync="false" src="../../js/ismobile.js"></script>
<script data-cfasync="false" src="../../js/app.js"></script>
<script data-cfasync="false" src="../../js/retina.js"></script>
<script data-cfasync="false" src="../../js/dropit.js"></script>
<script data-cfasync="false" src="../../js/prism.js"></script>
<link rel="stylesheet" href="../../../cdn.jsdelivr.net/npm/docsearch.js%402/dist/cdn/docsearch.min.css" />
</head>
<body class="non-en-doc">
<section class="page content">
<header>
<div id="mobile-menu">
<div id="nav-button" class="fa fa-bars fa-2x button"></div>
</div>
<section id="logo"><a href="../../index.html" class="express">Express</a>
</section>
<div id="navbar">
<input id="q" placeholder="ğŸ” search">
<ul id="navmenu">
<li><a href="../index.html" id="home-menu">ä¸»é¡µ</a></li>
<li>
<ul id="getting-started-menu" class="menu">
<li><a href="../starter/installing.html">å…¥é—¨</a>
<ul>
<li>
<a href="../starter/installing.html">
å®‰è£…
</a>
</li>
<li>
<a href="../starter/hello-world.html">
Hello world
</a>
</li>
<li>
<a href="../starter/generator.html">
Express ç”Ÿæˆå™¨
</a>
</li>
<li>
<a href="../starter/basic-routing.html">
åŸºæœ¬è·¯ç”±
</a>
</li>
<li>
<a href="../starter/static-files.html">
é™æ€æ–‡ä»¶
</a>
</li>
<li>
<a href="../starter/faq.html">
å¸¸è§é—®é¢˜åŠè§£ç­”
</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="guide-menu" class="menu">
<li><a href="routing.html" class="active">æŒ‡å—</a>
<ul>
<li><a href="routing.html">è·¯ç”±</a>
</li>
<li><a href="writing-middleware.html">ç¼–å†™ä¸­é—´ä»¶</a>
</li>
<li><a href="using-middleware.html">ä½¿ç”¨ä¸­é—´ä»¶</a>
</li>
<li><a href="using-template-engines.html">ä½¿ç”¨æ¨¡æ¿å¼•æ“</a>
</li>
<li><a href="error-handling.html">é”™è¯¯å¤„ç†</a>
</li>
<li><a href="debugging.html">è°ƒè¯•</a>
</li>
<li><a href="behind-proxies.html">ä»£ç†èƒŒåçš„ Express</a>
</li>
<li><a href="migrating-4.html">è¿ç§»åˆ° Express 4</a>
</li>
<li><a href="migrating-5.html">è¿ç§»åˆ° Express 5</a>
</li>
<li><a href="database-integration.html">æ•°æ®åº“é›†æˆ</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="application-menu" class="menu">
<li><a href="../4x/api.html">API å‚è€ƒ</a>
<ul>
<li><a href="../4x/api.html">4.x</a>
</li>
<li><a href="../3x/api.html">3.xï¼ˆä¸æ¨èï¼‰</a>
</li>
<li><a href="../../2x/index.html">2.xï¼ˆä¸æ¨èï¼‰</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="advanced-topics-menu" class="menu">
<li><a href="../advanced/developing-template-engines.html">é«˜çº§ä¸»é¢˜</a>
<ul>
<li><a href="../advanced/developing-template-engines.html">æ¨¡æ¿å¼•æ“</a>
</li>
<li><a href="../advanced/pm.html">ä½¿ç”¨è¿›ç¨‹ç®¡ç†å™¨</a>
</li>
<li><a href="../advanced/security-updates.html">å®‰å…¨æ›´æ–°</a>
</li>
<li><a href="../advanced/best-practice-security.html">å®‰å…¨æœ€ä½³å®è·µ</a>
</li>
<li><a href="../advanced/best-practice-performance.html">æ€§èƒ½æœ€ä½³å®è·µ</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<ul id="resources-menu" class="menu">
<li><a href="../resources/glossary.html">èµ„æº</a>
<ul>
<li><a href="../resources/glossary.html">è¯æ±‡è¡¨</a>
</li>
<li><a href="../resources/middleware.html">ä¸­é—´ä»¶</a>
</li>
<li><a href="../resources/community.html">ç¤¾åŒº</a>
</li>
<li><a href="../resources/books-blogs.html">ä¹¦ç±å’Œåšå®¢</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</header>
<div id="overlay"></div>
<div id="i18n-notice-box" class="doc-box doc-warn">
<p><p>è¿™ä¸ªç¿»è¯‘<a href="http://strongloop.com/">StrongLoop / IBM</a>æä¾›.</p>
ç›¸å¯¹äºè‹±æ–‡ç‰ˆçš„æ–‡æ¡£ï¼Œæœ¬æ–‡æ¡£å¯èƒ½å·²è¿‡æ—¶ã€‚è¦äº†è§£æœ€è¿‘çš„æ›´æ–°ï¼Œè¯·å‚é˜…<a href="../../index.html">è‹±æ–‡ç‰ˆæ–‡æ¡£</a>ã€‚
</p>
<div id="close-i18n-notice-box" title="Close">âœ–</div>
</div>
<div id="page-doc" markdown="1">
<h1 id="è¿ç§»åˆ°-express-4">è¿ç§»åˆ° Express 4</h1>
<h2 id="overview">æ¦‚è¿°</h2>
<p>Express 4 å¯¹ Express 3 è¿›è¡Œäº†é‡å¤§æ›´æ”¹ï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœæ‚¨åœ¨ç°æœ‰ Express 3 åº”ç”¨ç¨‹åºçš„ä¾èµ–é¡¹ä¸­æ›´æ–°äº† Express ç‰ˆæœ¬ï¼Œé‚£ä¹ˆè¯¥åº”ç”¨ç¨‹åºå°†æ— æ³•å·¥ä½œã€‚</p>
<p>æœ¬æ–‡è®²è¿°ï¼š</p>
<ul class="doclist">
<li><a href="#changes">Express 4 ä¸­çš„æ›´æ”¹ã€‚</a></li>
<li>å°† Express 3 åº”ç”¨ç¨‹åºè¿ç§»åˆ° Express 4 çš„<a href="#example-migration">ç¤ºä¾‹</a>ã€‚</li>
<li><a href="#app-gen">å‡çº§åˆ° Express 4 åº”ç”¨ç¨‹åºç”Ÿæˆå™¨ã€‚</a></li>
</ul>
<h2 id="changes">Express 4 ä¸­çš„æ›´æ”¹</h2>
<p>Express 4 ä¸­è¿›è¡Œäº†è‹¥å¹²é‡å¤§æ›´æ”¹ï¼š</p>
<ul class="doclist">
<li><a href="#core-changes">å¯¹ Express æ ¸å¿ƒå’Œä¸­é—´ä»¶ç³»ç»Ÿè¿›è¡Œäº†æ›´æ”¹ã€‚</a>ç§»é™¤äº† Connect ä¾èµ–é¡¹å’Œå†…ç½®çš„ä¸­é—´ä»¶ï¼Œæ‰€ä»¥æ‚¨å¿…é¡»è‡ªå·±æ·»åŠ ä¸­é—´ä»¶ã€‚</li>
<li><a href="#routing">å¯¹è·¯ç”±ç³»ç»Ÿè¿›è¡Œäº†æ›´æ”¹ã€‚</a></li>
<li><a href="#other-changes">å…¶ä»–å„ç§æ›´æ”¹ã€‚</a></li>
</ul>
<p>å¦è¯·å‚é˜…ï¼š</p>
<ul>
<li><a href="https://github.com/strongloop/express/wiki/New-features-in-4.x">New features in 4.x</a>ã€‚</li>
<li><a href="https://github.com/strongloop/express/wiki/Migrating-from-3.x-to-4.x">Migrating from 3.x to 4.x</a>ã€‚</li>
</ul>
<h3 id="core-changes">
å¯¹ Express æ ¸å¿ƒå’Œä¸­é—´ä»¶ç³»ç»Ÿçš„æ›´æ”¹ã€‚
</h3>
<p>Express 4 ä¸å†ä¾èµ–äº Connectï¼Œä»å…¶æ ¸å¿ƒç§»é™¤äº†æ‰€æœ‰å†…ç½®çš„ä¸­é—´ä»¶ï¼ˆé™¤äº† <code>express.static</code> å‡½æ•°ï¼‰ã€‚è¿™æ„å‘³ç€ Express ç°åœ¨æ˜¯ç‹¬ç«‹çš„è·¯ç”±å’Œä¸­é—´ä»¶ Web æ¡†æ¶ï¼ŒExpress çš„ç‰ˆæœ¬æ§åˆ¶å’Œå‘è¡Œä¸å—ä¸­é—´ä»¶æ›´æ–°çš„å½±å“ã€‚</p>
<p>ç”±äºæ²¡æœ‰å†…ç½®ä¸­é—´ä»¶ï¼Œå› æ­¤æ‚¨å¿…é¡»æ˜¾å¼æ·»åŠ æ‰€éœ€çš„æ‰€æœ‰ä¸­é—´ä»¶æ‰èƒ½è¿è¡Œåº”ç”¨ç¨‹åºã€‚åªéœ€æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>å®‰è£…æ¨¡å—ï¼š<code>npm install --save &lt;module-name&gt;</code></li>
<li>åœ¨åº”ç”¨ç¨‹åºä¸­éœ€è¦æ­¤æ¨¡å—ï¼š<code>require('module-name')</code></li>
<li>æ ¹æ®æ–‡æ¡£ä½¿ç”¨æ¨¡å—ï¼š<code>app.use( ... )</code></li>
</ol>
<p>ä¸‹è¡¨åˆ—å‡ºäº† Express 3 ä¸­é—´ä»¶åŠå…¶åœ¨ Express 4 ä¸­çš„å¯¹åº”ç»„ä»¶ã€‚</p>
<table class="doctable" border="1">
<tr><th>Express 3</th><th>Express 4</th></tr>
<tr><td><code>express.bodyParser</code></td>
<td><a href="https://github.com/expressjs/body-parser">body-parser</a> +
<a href="https://github.com/expressjs/multer">multer</a></td></tr>
<tr><td><code>express.compress</code></td>
<td><a href="https://github.com/expressjs/compression">compression</a></td></tr>
<tr><td><code>express.cookieSession</code></td>
<td><a href="https://github.com/expressjs/cookie-session">cookie-session</a></td></tr>
<tr><td><code>express.cookieParser</code></td>
<td><a href="https://github.com/expressjs/cookie-parser">cookie-parser</a></td></tr>
<tr><td><code>express.logger</code></td>
<td><a href="https://github.com/expressjs/morgan">morgan</a></td></tr>
<tr><td><code>express.session</code></td>
<td><a href="https://github.com/expressjs/session">express-session</a></td></tr>
<tr><td><code>express.favicon</code></td>
<td><a href="https://github.com/expressjs/serve-favicon">serve-favicon</a></td></tr>
<tr><td><code>express.responseTime</code></td>
<td><a href="https://github.com/expressjs/response-time">response-time</a></td></tr>
<tr><td><code>express.errorHandler</code></td>
<td><a href="https://github.com/expressjs/errorhandler">errorhandler</a></td></tr>
<tr><td><code>express.methodOverride</code></td>
<td><a href="https://github.com/expressjs/method-override">method-override</a></td></tr>
<tr><td><code>express.timeout</code></td>
<td><a href="https://github.com/expressjs/timeout">connect-timeout</a></td></tr>
<tr><td><code>express.vhost</code></td>
<td><a href="https://github.com/expressjs/vhost">vhost</a></td></tr>
<tr><td><code>express.csrf</code></td>
<td><a href="https://github.com/expressjs/csurf">csurf</a></td></tr>
<tr><td><code>express.directory</code></td>
<td><a href="https://github.com/expressjs/serve-index">serve-index</a></td></tr>
<tr><td><code>express.static</code></td>
<td><a href="https://github.com/expressjs/serve-static">serve-static</a></td></tr>
</table>
<p>å¯å‚è€ƒ Express 4 ä¸­é—´ä»¶çš„<a href="https://github.com/senchalabs/connect#middleware">å®Œæ•´åˆ—è¡¨</a>ã€‚</p>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯ä»¥å°†æ—§çš„ V3 ä¸­é—´ä»¶æ›¿æ¢ä¸º Express 4 çš„å¯¹åº”ç»„ä»¶ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… GitHub ä¸­çš„æ¨¡å—æ–‡æ¡£ã€‚</p>
<h4 id="app-use"><code>app.use</code> å¯ä»¥ä½¿ç”¨å‚æ•°</h4>
<p>åœ¨ V4 ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å˜é‡å‚æ•°æ¥å®šä¹‰è£…å…¥ä¸­é—´ä»¶å‡½æ•°çš„è·¯å¾„ï¼Œç„¶åä»è·¯ç”±å¤„ç†ç¨‹åºè¯»å–å‚æ•°çš„å€¼ã€‚
ä¾‹å¦‚ï¼š</p>
<pre><code class="language-javascript" translate="no">
app.use('/book/:id', function(req, res, next) {
  console.log('ID:', req.params.id);
  next();
});
</code>
</pre>
<h3 id="routing">
è·¯ç”±ç³»ç»Ÿ
</h3>
<p>åº”ç”¨ç¨‹åºç°åœ¨éšå¼è£…å…¥è·¯ç”±ä¸­é—´ä»¶ï¼Œæ‰€ä»¥æ‚¨ä¸å†éœ€è¦æ‹…å¿ƒå…¶ä»–ä¸­é—´ä»¶ç›¸å¯¹äº<code>è·¯ç”±</code>ä¸­é—´ä»¶çš„è£…å…¥é¡ºåºã€‚</p>
<p>å®šä¹‰è·¯ç”±çš„æ–¹å¼å¹¶æœªæ”¹å˜ï¼Œä½†æ˜¯è·¯ç”±ç³»ç»Ÿæ–°å¢äº†ä¸¤ä¸ªåŠŸèƒ½ï¼Œç”¨äºå¸®åŠ©ç»„ç»‡è·¯ç”±ï¼š</p>
<ul class="doclist">
<li>ä¸€ä¸ªæ–°æ–¹æ³• <code>app.route()</code>ï¼Œç”¨äºä¸ºè·¯ç”±è·¯å¾„åˆ›å»ºå¯é“¾æ¥çš„è·¯ç”±å¤„ç†ç¨‹åºã€‚</li>
<li>ä¸€ä¸ªæ–°ç±» <code>express.Router</code>ï¼Œç”¨äºåˆ›å»ºå¯å®‰è£…çš„æ¨¡å—åŒ–è·¯ç”±å¤„ç†ç¨‹åºã€‚</li>
</ul>
<h4 id="app-route"><code>app.route()</code> æ–¹æ³•</h4>
<p>æ–°çš„ <code>app.route()</code> æ–¹æ³•ä½¿æ‚¨å¯ä»¥ä¸ºè·¯ç”±è·¯å¾„åˆ›å»ºå¯é“¾æ¥çš„è·¯ç”±å¤„ç†ç¨‹åºã€‚åˆ›å»ºæ¨¡å—åŒ–è·¯ç”±å¾ˆæœ‰å¸®åŠ©ï¼Œå› ä¸ºåœ¨å•ä¸€ä½ç½®æŒ‡å®šè·¯å¾„ï¼Œæ‰€ä»¥å¯ä»¥å‡å°‘å†—ä½™å’Œè¾“å…¥é”™è¯¯ã€‚æœ‰å…³è·¯ç”±çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="../4x/api.html#router"><code>Router()</code> æ–‡æ¡£</a>ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ <code>app.route()</code> å‡½æ•°å®šä¹‰çš„é“¾å¼è·¯ç”±å¤„ç†ç¨‹åºçš„ç¤ºä¾‹ã€‚</p>
<pre><code class="language-javascript" translate="no">
app.route('/book')
  .get(function(req, res) {
    res.send('Get a random book');
  })
  .post(function(req, res) {
    res.send('Add a book');
  })
  .put(function(req, res) {
    res.send('Update the book');
  });
</code>
</pre>
<h4 id="express-router"><code>express.Router</code> ç±»</h4>
<p>æœ‰åŠ©äºç»„ç»‡è·¯ç”±çš„å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯æ–°ç±» <code>express.Router</code>ï¼Œå¯ç”¨äºåˆ›å»ºå¯å®‰è£…çš„æ¨¡å—åŒ–è·¯ç”±å¤„ç†ç¨‹åºã€‚<code>Router</code> å®ä¾‹æ˜¯å®Œæ•´çš„ä¸­é—´ä»¶å’Œè·¯ç”±ç³»ç»Ÿï¼›å› æ­¤ï¼Œå¸¸å¸¸å°†å…¶ç§°ä¸ºâ€œå¾®å‹åº”ç”¨ç¨‹åºâ€ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹å°†è·¯ç”±å™¨åˆ›å»ºä¸ºæ¨¡å—ï¼Œåœ¨å…¶ä¸­è£…å…¥ä¸­é—´ä»¶ï¼Œå®šä¹‰ä¸€äº›è·¯ç”±ï¼Œç„¶åå®‰è£…åœ¨ä¸»åº”ç”¨ç¨‹åºçš„è·¯å¾„ä¸­ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨åº”ç”¨ç¨‹åºç›®å½•ä¸­åˆ›å»ºåä¸º <code>birds.js</code> çš„è·¯ç”±å™¨æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="language-javascript" translate="no">
var express = require('express');
var router = express.Router();

// middleware specific to this router
router.use(function timeLog(req, res, next) {
  console.log('Time: ', Date.now());
  next();
});
// define the home page route
router.get('/', function(req, res) {
  res.send('Birds home page');
});
// define the about route
router.get('/about', function(req, res) {
  res.send('About birds');
});

module.exports = router;
</code>
</pre>
<p>æ¥ç€ï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­è£…å…¥è·¯ç”±å™¨æ¨¡å—ï¼š</p>
<pre><code class="language-javascript" translate="no">
var birds = require('./birds');
...
app.use('/birds', birds);
</code>
</pre>
<p>æ­¤åº”ç”¨ç¨‹åºç°åœ¨å¯å¤„ç†é’ˆå¯¹ <code>/birds</code> å’Œ <code>/birds/about</code> è·¯å¾„çš„è¯·æ±‚ï¼Œè°ƒç”¨ç‰¹å®šäºæ­¤è·¯ç”±çš„ <code>timeLog</code> ä¸­é—´ä»¶ã€‚</p>
<h3 id="other-changes">
å…¶ä»–æ›´æ”¹
</h3>
<p>ä¸‹è¡¨åˆ—å‡º Express 4 ä¸­è™½å°ä½†é‡è¦çš„å…¶ä»–æ›´æ”¹ï¼š</p>
<table class="doctable" border="1">
<tr>
<th>å¯¹è±¡</th>
<th>æè¿°</th>
</tr>
<tr>
<td>Node.js</td>
<td>Express 4 éœ€è¦ Node.js 0.10.x æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œå·²å–æ¶ˆå¯¹ Node.js 0.8.x çš„æ”¯æŒã€‚</td>
</tr>
<tr>
<td>
<p><code>http.createServer()</code></p>
</td>
<td>
<p>ä¸å†éœ€è¦ <code>http</code> æ¨¡å—ï¼Œé™¤éæ‚¨è¦ç›´æ¥ä½¿ç”¨å®ƒ (socket.io/SPDY/HTTPS)ã€‚å¯ä»¥ä½¿ç”¨ <code>app.listen()</code> å‡½æ•°æ¥å¯åŠ¨æ­¤åº”ç”¨ç¨‹åºã€‚</p>
</td>
</tr>
<tr>
<td>
<p><code>app.configure()</code></p>
</td>
<td>
<p>å·²ç§»é™¤ <code>app.configure()</code> å‡½æ•°ã€‚ä½¿ç”¨ <code>process.env.NODE_ENV</code> æˆ– <code>app.get('env')</code> åŠŸèƒ½æ¥æ£€æµ‹ç¯å¢ƒå¹¶ç›¸åº”é…ç½®è¯¥åº”ç”¨ç¨‹åºã€‚</p>
</td>
</tr>
<tr>
<td>
<p><code>json spaces</code></p>
</td>
<td>
<p>åœ¨ Express 4 ä¸­ï¼Œç¼ºçœæƒ…å†µä¸‹ï¼Œå·²ç¦ç”¨ <code>json spaces</code> åº”ç”¨ç¨‹åºå±æ€§ã€‚</p>
</td>
</tr>
<tr>
<td>
<p><code>req.accepted()</code></p>
</td>
<td>
<p>ä½¿ç”¨ <code>req.accepts()</code>ã€<code>req.acceptsEncodings()</code>ã€<code>req.acceptsCharsets()</code> å’Œ <code>req.acceptsLanguages()</code>ã€‚</p>
</td>
</tr>
<tr>
<td>
<p><code>res.location()</code></p>
</td>
<td>
<p>ä¸å†è§£æç›¸å¯¹ URLã€‚</p>
</td>
</tr>
<tr>
<td>
<p><code>req.params</code></p>
</td>
<td>
<p>åŸæ¥æ˜¯æ•°ç»„ï¼›ç°åœ¨æ˜¯å¯¹è±¡ã€‚</p>
</td>
</tr>
<tr>
<td>
<p><code>res.locals</code></p>
</td>
<td>
<p>åŸæ¥æ˜¯å‡½æ•°ï¼›ç°åœ¨æ˜¯å¯¹è±¡ã€‚</p>
</td>
</tr>
<tr>
<td>
<p><code>res.headerSent</code></p>
</td>
<td>
<p>æ›´æ”¹ä¸º <code>res.headersSent</code>ã€‚</p>
</td>
</tr>
<tr>
<td>
<p><code>app.route</code></p>
</td>
<td>
<p>ç°åœ¨å¯ä½œä¸º <code>app.mountpath</code> ä½¿ç”¨ã€‚</p>
</td>
</tr>
<tr>
<td>
<p><code>res.on('header')</code></p>
</td>
<td>
<p>å·²ç§»é™¤ã€‚</p>
</td>
</tr>
<tr>
<td>
<p><code>res.charset</code></p>
</td>
<td>
<p>å·²ç§»é™¤ã€‚</p>
</td>
</tr>
<tr>
<td>
<p><code>res.setHeader('Set-Cookie', val)</code></p>
</td>
<td>
<p>åŠŸèƒ½ç°åœ¨å·²é™åˆ¶ä¸ºè®¾ç½®åŸºæœ¬ cookie å€¼ã€‚å°† <code>res.cookie()</code> ç”¨äºå¢æ·»çš„åŠŸèƒ½ã€‚</p>
</td>
</tr>
</table>
<h2 id="example-migration">åº”ç”¨ç¨‹åºè¿ç§»ç¤ºä¾‹</h2>
<p>ä»¥ä¸‹æ˜¯å°† Express 3 åº”ç”¨ç¨‹åºè¿ç§»åˆ° Express 4 çš„ç¤ºä¾‹ã€‚
æ¶‰åŠçš„æ–‡ä»¶åŒ…æ‹¬ <code>app.js</code> å’Œ <code>package.json</code>ã€‚</p>
<h3>
V3 åº”ç”¨ç¨‹åº
</h3>
<h4><code>app.js</code></h4>
<p>è€ƒè™‘å…·æœ‰ä»¥ä¸‹ <code>app.js</code> æ–‡ä»¶çš„ Express V3 åº”ç”¨ç¨‹åºï¼š</p>
<pre><code class="language-javascript" translate="no">
var express = require('express');
var routes = require('./routes');
var user = require('./routes/user');
var http = require('http');
var path = require('path');

var app = express();

// all environments
app.set('port', process.env.PORT || 3000);
app.set('views', path.join(__dirname, 'views'));
app.set('view engine', 'pug');
app.use(express.favicon());
app.use(express.logger('dev'));
app.use(express.methodOverride());
app.use(express.session({ secret: 'your secret here' }));
app.use(express.bodyParser());
app.use(app.router);
app.use(express.static(path.join(__dirname, 'public')));

// development only
if ('development' == app.get('env')) {
  app.use(express.errorHandler());
}

app.get('/', routes.index);
app.get('/users', user.list);

http.createServer(app).listen(app.get('port'), function(){
  console.log('Express server listening on port ' + app.get('port'));
});
</code>
</pre>
<h4><code>package.json</code></h4>
<p>éšé™„çš„ V3 <code>package.json</code> æ–‡ä»¶å¯èƒ½å…·æœ‰ç±»ä¼¼äºä»¥ä¸‹çš„å†…å®¹ï¼š</p>
<pre><code class="language-javascript" translate="no">
{
  "name": "application-name",
  "version": "0.0.1",
  "private": true,
  "scripts": {
    "start": "node app.js"
  },
  "dependencies": {
    "express": "3.12.0",
    "pug": "*"
  }
}
</code>
</pre>
<h3>
è¿›ç¨‹
</h3>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… Express 4 åº”ç”¨ç¨‹åºçš„å¿…éœ€ä¸­é—´ä»¶å¹¶å°† Express å’Œ Pug åˆ†åˆ«æ›´æ–°åˆ°å…¶æœ€æ–°ç‰ˆæœ¬ï¼Œä»è€Œå¼€å§‹è¿ç§»è¿‡ç¨‹ï¼š</p>
<pre><code class="language-sh" translate="no">
$ npm install serve-favicon morgan method-override express-session body-parser multer errorhandler express@latest pug@latest --save
</code>
</pre>
<p>å¯¹ <code>app.js</code> è¿›è¡Œä»¥ä¸‹æ›´æ”¹ï¼š</p>
<ol>
<li>
<p>Express å†…ç½®ä¸­é—´ä»¶å‡½æ•° <code>express.favicon</code>ã€<code>express.logger</code>ã€<code>express.methodOverride</code>ã€<code>express.session</code>ã€<code>express.bodyParser</code> å’Œ <code>express.errorHandler</code> ä¸å†å¯ç”¨äº <code>express</code> å¯¹è±¡ã€‚æ‚¨å¿…é¡»æ‰‹åŠ¨å®‰è£…å…¶æ›¿ä»£é¡¹ï¼Œç„¶ååœ¨åº”ç”¨ç¨‹åºä¸­è£…å…¥ã€‚</p>
</li>
<li>
<p>ä¸å†éœ€è¦è£…å…¥ <code>app.router</code> å‡½æ•°ã€‚å®ƒä¸æ˜¯æœ‰æ•ˆçš„ Express 4 åº”ç”¨ç¨‹åºå¯¹è±¡ï¼Œæ‰€ä»¥ç§»é™¤äº† <code>app.use(app.router);</code> ä»£ç ã€‚</p>
</li>
<li>
<p>ç¡®ä¿ä»¥æ­£ç¡®é¡ºåºè£…å…¥ä¸­é—´ä»¶å‡½æ•° - åœ¨è£…å…¥åº”ç”¨ç¨‹åºè·¯ç”±ä¹‹åè£…å…¥ <code>errorHandler</code>ã€‚</p>
</li>
</ol>
<h3>V4 åº”ç”¨ç¨‹åº</h3>
<h4><code>package.json</code></h4>
<p>è¿è¡Œä»¥ä¸Š <code>npm</code> å‘½ä»¤ä¼šæ›´æ–° <code>package.json</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="language-javascript" translate="no">
{
  "name": "application-name",
  "version": "0.0.1",
  "private": true,
  "scripts": {
    "start": "node app.js"
  },
  "dependencies": {
    "body-parser": "^1.5.2",
    "errorhandler": "^1.1.1",
    "express": "^4.8.0",
    "express-session": "^1.7.2",
    "pug": "^2.0.0-beta6",
    "method-override": "^2.1.2",
    "morgan": "^1.2.2",
    "multer": "^0.1.3",
    "serve-favicon": "^2.0.1"
  }
}
</code>
</pre>
<h4><code>app.js</code></h4>
<p>éšåï¼Œç§»é™¤æ— æ•ˆä»£ç ï¼Œè£…å…¥æ‰€éœ€ä¸­é—´ä»¶ï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œå…¶ä»–æ›´æ”¹ã€‚<code>app.js</code> æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<pre><code class="language-javascript" translate="no">
var http = require('http');
var express = require('express');
var routes = require('./routes');
var user = require('./routes/user');
var path = require('path');

var favicon = require('serve-favicon');
var logger = require('morgan');
var methodOverride = require('method-override');
var session = require('express-session');
var bodyParser = require('body-parser');
var multer = require('multer');
var errorHandler = require('errorhandler');

var app = express();

// all environments
app.set('port', process.env.PORT || 3000);
app.set('views', path.join(__dirname, 'views'));
app.set('view engine', 'pug');
app.use(favicon(__dirname + '/public/favicon.ico'));
app.use(logger('dev'));
app.use(methodOverride());
app.use(session({ resave: true,
                  saveUninitialized: true,
                  secret: 'uwotm8' }));
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: true }));
app.use(multer());
app.use(express.static(path.join(__dirname, 'public')));

app.get('/', routes.index);
app.get('/users', user.list);

// error handling middleware should be loaded after the loading the routes
if ('development' == app.get('env')) {
  app.use(errorHandler());
}

var server = http.createServer(app);
server.listen(app.get('port'), function(){
  console.log('Express server listening on port ' + app.get('port'));
});
</code>
</pre>
<div class="doc-box doc-info">
<p>é™¤éæ‚¨éœ€è¦ç›´æ¥ä½¿ç”¨ <code>http</code> æ¨¡å— (socket.io/SPDY/HTTPS)ï¼Œå¦åˆ™ä¸éœ€è¦å°†å…¶è£…å…¥ï¼Œå¯æŒ‰ä»¥ä¸‹æ–¹å¼å¯åŠ¨æ­¤åº”ç”¨ç¨‹åºï¼š</p>
<pre><code class="language-js" translate="no">app.listen(app.get('port'), function(){
  console.log('Express server listening on port ' + app.get('port'));
});</code>
</pre>
</div>
<h3>è¿è¡Œåº”ç”¨ç¨‹åº</h3>
<p>è¿ç§»è¿‡ç¨‹å®Œæˆï¼Œæ­¤åº”ç”¨ç¨‹åºç°åœ¨æ˜¯ Express 4 ç‰ˆæœ¬ã€‚è¦è¿›è¡Œç¡®è®¤ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨æ­¤åº”ç”¨ç¨‹åºï¼š</p>
<pre><code class="language-sh" translate="no">
$ node .
</code>
</pre>
<p>è£…å…¥ <a href="http://localhost:3000/">http://localhost:3000</a>ï¼Œç„¶åæŸ¥çœ‹ Express 4 å‘ˆç°çš„ä¸»é¡µã€‚</p>
<h2 id="app-gen">å‡çº§åˆ° Express 4 åº”ç”¨ç¨‹åºç”Ÿæˆå™¨</h2>
<p>ç”¨äºç”Ÿæˆ Express åº”ç”¨ç¨‹åºçš„å‘½ä»¤è¡Œå·¥å…·ä»ç„¶æ˜¯ <code>express</code>ï¼Œä½†æ˜¯è¦å‡çº§åˆ°æ–°ç‰ˆæœ¬ï¼Œæ‚¨å¿…é¡»å¸è½½ Express 3 åº”ç”¨ç¨‹åºç”Ÿæˆå™¨ï¼Œç„¶åå®‰è£…æ–°çš„ <code>express-generator</code>ã€‚</p>
<h3>å®‰è£…</h3>
<p>å¦‚æœæ‚¨å·²ç»åœ¨ç³»ç»Ÿä¸Šå®‰è£…äº† Express 3 åº”ç”¨ç¨‹åºç”Ÿæˆå™¨ï¼Œå¿…é¡»å°†å…¶å¸è½½ï¼š</p>
<pre><code class="language-sh" translate="no">
$ npm uninstall -g express
</code>
</pre>
<p>æ ¹æ®æ‚¨çš„æ–‡ä»¶å’Œç›®å½•ç‰¹æƒçš„é…ç½®æ–¹å¼ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ <code>sudo</code> æ¥è¿è¡Œæ­¤å‘½ä»¤ã€‚
ç«‹å³å®‰è£…æ–°çš„ç”Ÿæˆå™¨ï¼š</p>
<pre><code class="language-sh" translate="no">
$ npm install -g express-generator
</code>
</pre>
<p>æ ¹æ®æ‚¨çš„æ–‡ä»¶å’Œç›®å½•ç‰¹æƒçš„é…ç½®æ–¹å¼ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ <code>sudo</code> æ¥è¿è¡Œæ­¤å‘½ä»¤ã€‚</p>
<p>ç°åœ¨ï¼Œç³»ç»Ÿä¸Šçš„ <code>express</code> å‘½ä»¤å·²æ›´æ–°åˆ° Express 4 ç”Ÿæˆå™¨ã€‚</p>
<h3>å¯¹åº”ç”¨ç¨‹åºç”Ÿæˆå™¨çš„æ›´æ”¹</h3>
<p>å‘½ä»¤é€‰é¡¹å’Œç”¨æ³•å¤§ä½“ä¿æŒç›¸åŒï¼Œä½†ä¹Ÿå­˜åœ¨ä»¥ä¸‹ä¾‹å¤–ï¼š</p>
<ul class="doclist">
<li>å·²ç§»é™¤ <code>--sessions</code> é€‰é¡¹ã€‚</li>
<li>å·²ç§»é™¤ <code>--jshtml</code> é€‰é¡¹ã€‚</li>
<li>å·²æ·»åŠ  <code>--hogan</code> é€‰é¡¹æ¥æ”¯æŒ <a href="http://twitter.github.io/hogan.js/">Hogan.js</a>ã€‚</li>
</ul>
<h3>ç¤ºä¾‹</h3>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»º Express 4 åº”ç”¨ç¨‹åºï¼š</p>
<pre><code class="language-sh" translate="no">
$ express app4
</code>
</pre>
<p>å¦‚æœæŸ¥çœ‹ <code>app4/app.js</code> æ–‡ä»¶çš„å†…å®¹ï¼Œé‚£ä¹ˆä¼šæ³¨æ„åˆ°åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ä¸­é—´ä»¶å‡½æ•°ï¼ˆé™¤äº† <code>express.static</code>ï¼‰éƒ½ä½œä¸ºç‹¬ç«‹æ¨¡å—è£…å…¥ï¼Œè€Œåœ¨åº”ç”¨ç¨‹åºä¸­ä¸å†æ˜¾å¼è£…å…¥ <code>router</code> ä¸­é—´ä»¶ã€‚</p>
<p>è¿˜å¯ä»¥æ³¨æ„åˆ°ï¼Œä¸æ—§ç”Ÿæˆå™¨ç”Ÿæˆçš„ç‹¬ç«‹åº”ç”¨ç¨‹åºç›¸åï¼Œ<code>app.js</code> æ–‡ä»¶ç°åœ¨æ˜¯ Node.js æ¨¡å—ã€‚</p>
<p>åœ¨å®‰è£…ä¾èµ–é¡¹ä¹‹åï¼Œå¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨æ­¤åº”ç”¨ç¨‹åºï¼š</p>
<pre><code class="language-sh" translate="no">
$ npm start
</code>
</pre>
<p>å¦‚æœæŸ¥çœ‹ <code>package.json</code> æ–‡ä»¶ä¸­çš„ npm å¯åŠ¨è„šæœ¬ï¼Œå¯ä»¥æ³¨æ„åˆ°å¯åŠ¨åº”ç”¨ç¨‹åºçš„å®é™…å‘½ä»¤æ˜¯ <code>node ./bin/www</code>ï¼Œè€Œè¿‡å»åœ¨ Express 3 ä¸­ï¼Œè¯¥å‘½ä»¤æ˜¯ <code>node app.js</code>ã€‚</p>
<p>å› ä¸º Express 4 ç”Ÿæˆå™¨ç”Ÿæˆçš„ <code>app.js</code> æ–‡ä»¶ç°åœ¨æ˜¯ Node.js æ¨¡å—ï¼Œæ‰€ä»¥ä¸å†èƒ½å¤Ÿå°†å…¶ä½œä¸ºåº”ç”¨ç¨‹åºç‹¬ç«‹å¯åŠ¨ï¼ˆé™¤éä¿®æ”¹ä»£ç ï¼‰ã€‚å¿…é¡»åœ¨ Node.js æ–‡ä»¶ä¸­åŠ è½½æ­¤æ¨¡å—ï¼Œå¹¶é€šè¿‡ Node.js æ–‡ä»¶å¯åŠ¨ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼ŒNode.js æ–‡ä»¶æ˜¯ <code>./bin/www</code>ã€‚</p>
<p>å¯¹äºåˆ›å»º Express åº”ç”¨ç¨‹åºæˆ–å¯åŠ¨æ­¤åº”ç”¨ç¨‹åºï¼Œ<code>bin</code> ç›®å½•æˆ–æ— æ‰©å±•åçš„ <code>www</code> æ–‡ä»¶éƒ½ä¸æ˜¯å¿…éœ€çš„ã€‚å®ƒä»¬åªæ˜¯ç”Ÿæˆå™¨æå‡ºçš„å»ºè®®ï¼Œå¯éšæ„æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œä¿®æ”¹ã€‚</p>
<p>å¦‚æœä¸æƒ³ä½¿ç”¨ <code>www</code> ç›®å½•ï¼Œè€Œæ˜¯ä¿æŒâ€œExpress 3 é£æ ¼â€ï¼Œè¯·åˆ é™¤ <code>app.js</code> æ–‡ä»¶æœ«å°¾çš„ <code>module.exports = app;</code> è¡Œï¼Œç„¶åå°†ä»¥ä¸‹ä»£ç ç²˜è´´åœ¨åˆ°è¯¥ä½ç½®ï¼š</p>
<pre><code class="language-javascript" translate="no">
app.set('port', process.env.PORT || 3000);

var server = app.listen(app.get('port'), function() {
  debug('Express server listening on port ' + server.address().port);
});
</code>
</pre>
<p>ç¡®ä¿ä½¿ç”¨ä»¥ä¸‹ä»£ç åœ¨ <code>app.js</code> æ–‡ä»¶ä¹‹ä¸Šè£…å…¥ <code>debug</code> æ¨¡å—ï¼š</p>
<pre><code class="language-javascript" translate="no">
var debug = require('debug')('app4');
</code>
</pre>
<p>ä¸‹ä¸€æ­¥ï¼Œå°† <code>package.json</code> æ–‡ä»¶ä¸­çš„ <code>"start": "node ./bin/www"</code> æ›´æ”¹ä¸º <code>"start": "node app.js"</code>ã€‚</p>
<p>ç°åœ¨ï¼Œæ‚¨å·²å°† <code>./bin/www</code> çš„åŠŸèƒ½æ¢å¤ä¸º <code>app.js</code>ã€‚ä¸å»ºè®®è¿›è¡Œæ­¤æ›´æ”¹ï¼Œä½†æ˜¯æ­¤ç»ƒä¹ å¯ä»¥å¸®åŠ©æ‚¨ç†è§£ <code>./bin/www</code> æ–‡ä»¶çš„å·¥ä½œæ–¹å¼ï¼Œä»¥åŠä¸ºä½• <code>app.js</code> æ–‡ä»¶ä¸å†è‡ªè¡Œå¯åŠ¨ã€‚</p>
</div>
</section>

<noscript>
    <iframe src="http://www.googletagmanager.com/ns.html?id=GTM-5XL76H" height="0" width="0" style="display: none; visibility: hidden;"></iframe>
</noscript>
<script type="2533438accf44815bc9febe5-text/javascript">
(function(w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
        'gtm.start': new Date().getTime(),
        event: 'gtm.js'
    });
    var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != 'dataLayer' ? '&l=' + l : '';
    j.async = true;
    j.src =
        '../../../www.googletagmanager.com/gtm5445.js?id=' + i + dl;
    f.parentNode.insertBefore(j, f);
})(window, document, 'script', 'dataLayer', 'GTM-5XL76H');
</script>
<a id="top" href="#"><img src="../../images/arrow.png"></a>
<footer>
<div id="footer-content">
<div id="github">
<iframe src="http://ghbtns.com/github-btn.html?user=expressjs&amp;repo=express&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe>
</div>
<div id="sponsor"><a href="https://github.com/expressjs/express">Express</a>æ˜¯Node.jsçš„åŸºé‡‘ä¼šçš„ä¸€ä¸ªé¡¹ç›®</div>
<div id="fork"><a href="https://github.com/expressjs/expressjs.com">åœ¨ GitHub ä¸Šæ´¾ç”Ÿå‡ºç½‘ç«™</a>ã€‚</div>
<div>Copyright &copy; StrongLoop, Inc., and other expressjs.com contributors.</div>
</div>
<div id="license">
<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/us/"><img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®" style="border-width:0" src="../../../i.creativecommons.org/l/by-sa/3.0/us/80x15.png" /></a> æœ¬ä½œå“é‡‡ç”¨<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/us/">çŸ¥è¯†å…±äº«ç½²å-ç›¸åŒæ–¹å¼å…±äº« 3.0 ç¾å›½è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯ã€‚
</div>
</footer>
<script type="2533438accf44815bc9febe5-text/javascript" src="../../../cdn.jsdelivr.net/npm/docsearch.js%402/dist/cdn/docsearch.min.js" onload="docsearch({
  apiKey: '7164e33055faa6ecddefd9e08fc59f5d',
  indexName: 'expressjs',
  inputSelector: '#q',
  algoliaOptions: { 'facetFilters': ['lang:zh-cn'] }
})" async></script>
<script src="../../../ajax.cloudflare.com/cdn-cgi/scripts/a2bd7673/cloudflare-static/rocket-loader.min.js" data-cf-settings="2533438accf44815bc9febe5-|49" defer=""></script></body>

<!-- Mirrored from expressjs.com/zh-cn/guide/migrating-4.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 10 Jul 2019 00:23:49 GMT -->
</html>
